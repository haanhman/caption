{"0":{"dur":2,"text":"[MUSIC PLAYING]"},"3":{"dur":1,"text":"JASON POLITES: My name's Jason."},"4":{"dur":2,"text":"I'm a product manager on\nGoogle Cloud Platform."},"7":{"dur":1,"text":"And as you can see,\ntoday we're going"},"9":{"dur":3,"text":"to be talking about building\nserverless applications"},"12":{"dur":3,"text":"with Google Cloud functions."},"15":{"dur":3,"text":"Before we do that, we\nmight need to just describe"},"18":{"dur":2,"text":"what this word, this weird\nword \"serverless\" that we"},"21":{"dur":3,"text":"see popping up all over\nthe place actually means."},"25":{"dur":4,"text":"And you might think that\nit means no servers, right?"},"29":{"dur":3,"text":"Well, kind of."},"32":{"dur":3,"text":"It could mean any, one,\nor all of these things,"},"36":{"dur":1,"text":"so no need to manage\nservers, no need"},"37":{"dur":2,"text":"to even think about servers."},"40":{"dur":2,"text":"There's a provisioning argument."},"42":{"dur":1,"text":"Maybe it's about\nwhat you pay for."},"44":{"dur":1,"text":"Maybe it's not\nabout billing, maybe"},"45":{"dur":4,"text":"it's about developer experience\nor the unit of deployment,"},"49":{"dur":2,"text":"et cetera."},"52":{"dur":2,"text":"For the purpose\nof today, I'm just"},"54":{"dur":2,"text":"going to narrow that scope."},"56":{"dur":1,"text":"So we're going to talk\nabout these four things."},"58":{"dur":2,"text":"Serverless by\ndefinition of something"},"61":{"dur":3,"text":"that you don't even need\nto think about servers,"},"64":{"dur":3,"text":"you pay only for what you\nuse, it's event-oriented,"},"68":{"dur":4,"text":"and you deploy\nfunctions and not apps."},"72":{"dur":2,"text":"OK, what does that really mean?"},"75":{"dur":1,"text":"In order to answer\nthat question,"},"76":{"dur":1,"text":"I'm going to tell\na little story."},"81":{"dur":3,"text":"This is Tony, and\nTony has an app."},"85":{"dur":3,"text":"And he's going to run his\napp on a virtual machine."},"88":{"dur":2,"text":"And so he launches the app,\nand the app gets some traffic,"},"91":{"dur":2,"text":"and his virtual machine\nis humming along nicely."},"93":{"dur":3,"text":"And then his app\ngets more popular"},"97":{"dur":1,"text":"and he gets more traffic."},"98":{"dur":3,"text":"And now, he can't fit on\na single virtual machine,"},"102":{"dur":4,"text":"but that's cool, he just gets\na second virtual machine."},"106":{"dur":3,"text":"And the extra traffic that\ncouldn't get on the first one"},"110":{"dur":2,"text":"flows over to the second one."},"112":{"dur":3,"text":"Now, if he's got some sort of\nload balancing ahead of this,"},"115":{"dur":4,"text":"it probably looks more something\nlike this, and that's fine."},"120":{"dur":0,"text":"Sweet."},"123":{"dur":5,"text":"But there's a problem with\nthis, and it's these gray boxes."},"128":{"dur":1,"text":"This means he's\nover-provisioned,"},"130":{"dur":4,"text":"so he's bought and paid for\ncapacity that he's not using,"},"135":{"dur":2,"text":"and that's costing him money."},"137":{"dur":1,"text":"Let's see if we can do better."},"139":{"dur":2,"text":"We're going to start\nwith a virtual machine,"},"142":{"dur":2,"text":"but this time, we're not\ngoing to deploy an application"},"144":{"dur":1,"text":"into that virtual\nmachine, we're just"},"146":{"dur":2,"text":"going to deploy a container."},"148":{"dur":3,"text":"And then when that container\nexhausts its resources,"},"152":{"dur":5,"text":"I deploy another container,\nand so on and so on and so on."},"157":{"dur":2,"text":"And then if I'm load\nbalancing, maybe it"},"160":{"dur":2,"text":"looks something like that."},"162":{"dur":1,"text":"So that looks good."},"164":{"dur":1,"text":"But then what if\nI need one more?"},"169":{"dur":3,"text":"Well, I need a whole\nnew virtual machine."},"172":{"dur":3,"text":"So we're kind of\nback to square one."},"175":{"dur":2,"text":"We still have an\nover-provisioning problem."},"178":{"dur":2,"text":"I'm still provisioning\ncapacity that I'm not using,"},"180":{"dur":2,"text":"and that's costing me money."},"182":{"dur":2,"text":"OK, let's try again."},"185":{"dur":1,"text":"What if we just\nremove the server?"},"190":{"dur":2,"text":"Now when he wants to\nadd a new container,"},"192":{"dur":2,"text":"he just adds a new container."},"195":{"dur":2,"text":"Sweet."},"197":{"dur":2,"text":"We still do have some\nwaste here, though."},"199":{"dur":3,"text":"You can see there's still a\nbunch of gray boxes there."},"203":{"dur":1,"text":"So that's still somewhat\nover-provisioned"},"205":{"dur":1,"text":"and still costing money."},"210":{"dur":2,"text":"What if we were to shrink\nthis unit of compute?"},"213":{"dur":4,"text":"Rather than deploying a\nVM image or a container,"},"217":{"dur":3,"text":"what if we made it\nas small as possible?"},"220":{"dur":1,"text":"So each little unit\nis going to have"},"222":{"dur":1,"text":"its own amount of capacity."},"224":{"dur":3,"text":"And so the amount that we're\nover-provisioning is even less."},"227":{"dur":1,"text":"You're still going\nto have a little bit."},"230":{"dur":2,"text":"You're not going to be able\nto get rid of it entirely,"},"233":{"dur":2,"text":"but this is a much\nbetter place to be."},"236":{"dur":1,"text":"And so you end up\nin this world where"},"237":{"dur":3,"text":"you have independent units of\ncompute, independent functions,"},"241":{"dur":2,"text":"that scale independently."},"243":{"dur":1,"text":"And the amount of\nover-provisioning"},"245":{"dur":1,"text":"is as low as it can be."},"250":{"dur":1,"text":"If I scale\nindependently, they're"},"252":{"dur":2,"text":"isolated from one another,\nthey're stateless,"},"255":{"dur":3,"text":"and they more closely\nmatch the traffic pattern."},"258":{"dur":3,"text":"So some functions will execute\nfrequently, some functions not"},"261":{"dur":2,"text":"so much."},"264":{"dur":0,"text":"Sweet."},"269":{"dur":3,"text":"So that's, broadly\nspeaking, a view"},"273":{"dur":3,"text":"of computing that's\nserverless, and what that means"},"276":{"dur":1,"text":"and why it's important."},"278":{"dur":4,"text":"But how do you use this, and\nwhy does this matter to you?"},"283":{"dur":2,"text":"So just hold that thought."},"285":{"dur":4,"text":"I'm going to switch gears and\ntalk about some use cases."},"290":{"dur":1,"text":"Imagine you're building\na booking system."},"292":{"dur":2,"text":"And I apologize that this\nis a somewhat dry and boring"},"295":{"dur":3,"text":"example, but it'll\nserve the purpose."},"298":{"dur":1,"text":"You have some\napplication, some bit"},"300":{"dur":1,"text":"of compute, that's\naccepting data."},"302":{"dur":2,"text":"Maybe it's accepting orders."},"305":{"dur":3,"text":"And you want to write those\norders to some back end storage"},"308":{"dur":4,"text":"In this case, I'm choosing\nCloud Storage as the example."},"313":{"dur":2,"text":"And so that's really the\nguts of your application--"},"315":{"dur":3,"text":"just take orders and\nwrite them to storage."},"318":{"dur":1,"text":"Now you have a new requirement."},"319":{"dur":1,"text":"Maybe you want to\ndo some indexing"},"321":{"dur":3,"text":"or some processing of this\norder before it goes to storage."},"325":{"dur":3,"text":"And so you implement, in code,\nsome indexing or some library"},"328":{"dur":1,"text":"that does this work for you."},"330":{"dur":3,"text":"But maybe that library or\nthat code that you've written"},"333":{"dur":1,"text":"depends on a database,\nso it needs to write out"},"335":{"dur":1,"text":"to a database or an index."},"337":{"dur":3,"text":"And maybe it needs some special\nfile or rules to do that."},"340":{"dur":2,"text":"And probably, it needs some\nsort of special authentication."},"343":{"dur":0,"text":"So that's OK."},"344":{"dur":3,"text":"You put all of that into your\napplication, and it looks good."},"348":{"dur":4,"text":"Meanwhile, elsewhere, you have\nanother application, completely"},"353":{"dur":3,"text":"separate, that's\ntaking some other data,"},"356":{"dur":1,"text":"but it needs to do\nsomething similar."},"358":{"dur":1,"text":"This time, maybe\nit's taking invoices"},"360":{"dur":1,"text":"and it's writing\nthem to storage."},"361":{"dur":3,"text":"And then maybe you also need\nto index that data as well,"},"365":{"dur":1,"text":"and you want to reuse\nsome of this code"},"366":{"dur":4,"text":"that you've written\nover on the order side."},"370":{"dur":2,"text":"So now, again, you need\nthe same database network"},"373":{"dur":3,"text":"and authentication configuration\nthat you had previously."},"377":{"dur":3,"text":"That will work, and\nthat happens routinely."},"381":{"dur":1,"text":"But this might be a problem."},"383":{"dur":1,"text":"You've duplicated\nthis configuration"},"385":{"dur":1,"text":"and these settings and\nthis authentication"},"387":{"dur":2,"text":"in two different places, not to\nmention duplicating the code."},"390":{"dur":2,"text":"So what does that mean\nfor things like security,"},"393":{"dur":3,"text":"things like deployment?"},"396":{"dur":2,"text":"If you change this\nlibrary, do you"},"398":{"dur":2,"text":"have to deploy both\nversions of your application"},"401":{"dur":1,"text":"simultaneously?"},"402":{"dur":1,"text":"Let's see if we\ncan improve this."},"407":{"dur":1,"text":"So same application."},"408":{"dur":3,"text":"Two different sides of\nit-- invoices and orders."},"411":{"dur":3,"text":"This time, we're going to\nimplement a separate API."},"415":{"dur":3,"text":"And the applications are\ngoing to call that API"},"418":{"dur":2,"text":"rather than writing\ndirectly to storage."},"421":{"dur":3,"text":"And that API is going to\nwrite the file to storage,"},"424":{"dur":1,"text":"and it's going to\ndo all the indexing"},"425":{"dur":3,"text":"and have those dependencies."},"428":{"dur":1,"text":"This is classically\nwhat we might"},"430":{"dur":3,"text":"term, in a very simplistic way,\na microservices approach, where"},"433":{"dur":3,"text":"you separate logic into\nservices rather than baking it"},"437":{"dur":1,"text":"into the application."},"439":{"dur":1,"text":"And this is totally fine--"},"441":{"dur":4,"text":"great architecture, works\nwell, Tony loves it."},"445":{"dur":1,"text":"There is one small\nchallenge with this,"},"447":{"dur":3,"text":"and that is that\npreviously, you recall,"},"451":{"dur":3,"text":"we were writing from the\ncompute to storage directly."},"454":{"dur":2,"text":"And the storage, let's\nsay, was a managed service"},"456":{"dur":1,"text":"like Cloud Storage."},"458":{"dur":4,"text":"So it had SLAs and it had all\nsorts of uptime guarantees."},"462":{"dur":1,"text":"And now we've\ncreated our own API"},"463":{"dur":2,"text":"that we have to scale ourselves\nand have to manage ourselves."},"466":{"dur":2,"text":"And so we've introduced\na point of failure here."},"469":{"dur":3,"text":"It's not terrible, and there's\nmany ways to mitigate that,"},"472":{"dur":2,"text":"but you now do have to\nthink about how do I"},"475":{"dur":1,"text":"deal with that failure?"},"476":{"dur":2,"text":"How does the application deal\nwith the failure to index"},"479":{"dur":0,"text":"the data?"},"480":{"dur":1,"text":"What does it do?"},"481":{"dur":4,"text":"So we might be able\nto do one step better."},"485":{"dur":1,"text":"Same application."},"486":{"dur":2,"text":"This time, I'm going to go\nback to what I had before."},"489":{"dur":1,"text":"I'm writing directly to storage."},"491":{"dur":2,"text":"What if the storage\nsystem itself was aware"},"493":{"dur":3,"text":"of that write, and it\ncould emit an event?"},"496":{"dur":2,"text":"So when the write occurred,\nwhen the mutation in storage"},"499":{"dur":1,"text":"occurred, it would\nemit an event,"},"500":{"dur":2,"text":"and then I could attach\ncode to that event,"},"503":{"dur":2,"text":"and that code would\nhave the dependencies."},"506":{"dur":3,"text":"So in this model, I've solved,\nsort of, two problems in one."},"509":{"dur":2,"text":"I've solved the original\nproblem with duplication"},"511":{"dur":1,"text":"of configuration in code."},"513":{"dur":3,"text":"And I've also solved the\nproblem of not depending"},"516":{"dur":5,"text":"on a managed service and the\nreliability challenges that"},"521":{"dur":1,"text":"might present."},"523":{"dur":2,"text":"So looks good, right?"},"525":{"dur":4,"text":"Well, there is one\nmore issue here."},"529":{"dur":2,"text":"Those two applications\nwere pretty heavyweight,"},"532":{"dur":3,"text":"and they required virtual\nmachines under a lot of load."},"535":{"dur":1,"text":"But this one little piece\nthat I've pulled out"},"537":{"dur":1,"text":"doesn't get called all\nthe time, or maybe it"},"539":{"dur":2,"text":"doesn't need many resources."},"541":{"dur":3,"text":"So now I'm back to this\nover-provisioning situation."},"545":{"dur":3,"text":"If only I had a smaller\nunit of compute that I"},"548":{"dur":3,"text":"could use in place of that."},"552":{"dur":2,"text":"And the good news is that we do."},"554":{"dur":0,"text":"Sweet."},"558":{"dur":4,"text":"So Google Cloud Functions is\nthat lightweight, small unit"},"562":{"dur":1,"text":"of compute."},"563":{"dur":2,"text":"It's a serverless environment\nto build and connect"},"566":{"dur":1,"text":"cloud services with code."},"571":{"dur":2,"text":"The characteristics of\nCloud Functions are this."},"574":{"dur":1,"text":"You don't need to even\nthink about service."},"576":{"dur":1,"text":"You pay only for what you use."},"578":{"dur":3,"text":"It is event-oriented, and you\ndeploy in units of functions,"},"582":{"dur":1,"text":"not apps."},"583":{"dur":1,"text":"And you'll recall\nthat this is where"},"584":{"dur":4,"text":"we started in our definition."},"589":{"dur":2,"text":"OK, pretty simple\ndiagram, but just"},"591":{"dur":1,"text":"to give a sense\nof what that looks"},"593":{"dur":3,"text":"like, your cloud environment\nwill emit events,"},"597":{"dur":2,"text":"Mutation on the storage\nbucket might be an event,"},"599":{"dur":2,"text":"mutation on a database\nmight be an event."},"602":{"dur":2,"text":"Also, external services\nwill emit events."},"604":{"dur":2,"text":"Typically, this is materialized\nas a webhook callback"},"607":{"dur":0,"text":"or something like that."},"608":{"dur":1,"text":"So a commit to GitHub."},"609":{"dur":1,"text":"And you can configure\nthat to call you back"},"611":{"dur":2,"text":"with a webhook over HTTP."},"614":{"dur":4,"text":"Your function will come to\nlife, respond to that event,"},"618":{"dur":1,"text":"and then from\nwithin the function,"},"619":{"dur":2,"text":"you can do anything that you\ncan do in a normal computing"},"621":{"dur":0,"text":"environment."},"622":{"dur":1,"text":"You can call an API."},"624":{"dur":1,"text":"You can write back\nto the database."},"625":{"dur":1,"text":"You can call an external API."},"631":{"dur":4,"text":"In Cloud Functions within\nGoogle, we have two flavors."},"635":{"dur":3,"text":"An HTTP function is a function\nyou deploy with an HTTP"},"639":{"dur":4,"text":"trigger, and will give you back,\nimmediately, a URL with a TLS"},"644":{"dur":3,"text":"certificate so it's secure, and\nyou can curl that straightaway."},"647":{"dur":1,"text":"That would be for\nsynchronous use cases."},"649":{"dur":4,"text":"The webhook callback will\nwork out-of-the-box for this."},"654":{"dur":1,"text":"The second flavor is\nthe background function."},"656":{"dur":1,"text":"This is where it\nhappens asynchronously."},"657":{"dur":3,"text":"There's an EventBus in between,\ntypically, Cloud Pub\/Sub."},"661":{"dur":2,"text":"This is where you don't\nneed to know the outcome"},"664":{"dur":1,"text":"of the function in real time."},"665":{"dur":3,"text":"You're happy for it to be\nprocessed in the background."},"669":{"dur":3,"text":"And typically, this will be\nas a result of an event being"},"672":{"dur":2,"text":"emitted from a cloud service."},"675":{"dur":1,"text":"So let's have a look\nat each of these"},"676":{"dur":2,"text":"in a little bit more detail."},"679":{"dur":3,"text":"HTTP-- this is the\nsimplest hello world"},"682":{"dur":2,"text":"HTTP function you can imagine."},"685":{"dur":3,"text":"We give you an HTTP request\nand response object."},"689":{"dur":1,"text":"This is in Node."},"690":{"dur":2,"text":"Anyone familiar with Node--"},"692":{"dur":3,"text":"the request and response is\nliterally an Express.js request"},"696":{"dur":2,"text":"and response."},"698":{"dur":2,"text":"And so if you've\never used Express.js,"},"700":{"dur":2,"text":"then you know how to do this."},"703":{"dur":1,"text":"Couple of things to point out--"},"705":{"dur":2,"text":"I just mentioned it's just\na regular request response,"},"707":{"dur":3,"text":"and then you have the full\naccess to the response object."},"711":{"dur":2,"text":"You don't need to do any\nsort of crazy translations"},"714":{"dur":1,"text":"on the way in or the way out."},"715":{"dur":1,"text":"It's just regular, old HTTP."},"721":{"dur":2,"text":"This is what a deploy might look\nlike for that from the command"},"724":{"dur":1,"text":"We also have a\nweb UI, which I'll"},"726":{"dur":2,"text":"show you in a little while."},"728":{"dur":1,"text":"You just deploy the function."},"730":{"dur":1,"text":"You give it a\nstage bucket, which"},"731":{"dur":2,"text":"is where we store your\ndeployment while we're"},"734":{"dur":1,"text":"building the function."},"736":{"dur":1,"text":"And then you just say\nit's a trigger HTTP,"},"738":{"dur":1,"text":"and we'll give you back a URL."},"744":{"dur":3,"text":"Background functions."},"747":{"dur":1,"text":"The only difference\nhere is instead"},"749":{"dur":2,"text":"of a request and\nresponse, we give you"},"751":{"dur":3,"text":"an event, which is the event\nthat was emitted from the cloud"},"755":{"dur":0,"text":"service--"},"756":{"dur":2,"text":"database mutation, storage\nmutation, et cetera--"},"759":{"dur":1,"text":"and we give you a callback."},"760":{"dur":3,"text":"The callback is because in\nruntime environments like Node,"},"764":{"dur":1,"text":"everything is asynchronous."},"765":{"dur":2,"text":"You might be doing some\nwork asynchronously,"},"768":{"dur":3,"text":"and you need to tell us\nwhen your function is done,"},"771":{"dur":1,"text":"and so you call the callback."},"773":{"dur":3,"text":"If you don't like using\ncallbacks, that's cool."},"776":{"dur":1,"text":"You can return a promise."},"777":{"dur":1,"text":"In fact, you can just\nreturn a discrete value"},"779":{"dur":2,"text":"and we'll treat it as a promise."},"781":{"dur":2,"text":"Again, for the people in the\naudience familiar with Node"},"784":{"dur":2,"text":"and JavaScript, this\nis particularly useful"},"786":{"dur":1,"text":"if you're using a third\nparty library that's"},"788":{"dur":1,"text":"going to return a promise."},"789":{"dur":2,"text":"You don't have to do\nany kind of black magic,"},"792":{"dur":1,"text":"you just return\nwhat they gave you."},"799":{"dur":3,"text":"And a couple of examples of\ndeploying background functions."},"802":{"dur":3,"text":"So one here is triggering\noff a Cloud Storage bucket,"},"805":{"dur":2,"text":"the other is triggering\nof a Cloud Pub\/Sub topic."},"815":{"dur":3,"text":"Dependencies."},"819":{"dur":2,"text":"It would be unusual,\nI think, for you"},"821":{"dur":2,"text":"to write a bit of code\nthat has no dependencies"},"823":{"dur":1,"text":"on any other modules\nor any other libraries."},"825":{"dur":3,"text":"Typically, you will depend on\nnumerous libraries of your own,"},"829":{"dur":2,"text":"or typically, third\nparty libraries."},"831":{"dur":2,"text":"In a Node.js environment, they\nare expressed in a manifest"},"834":{"dur":2,"text":"file called a package.json."},"836":{"dur":1,"text":"You declare your\ndependencies in there,"},"838":{"dur":3,"text":"and then there's a tool called\nNPM, Node Package Manager, that"},"842":{"dur":2,"text":"will resolve those dependencies,\ndownload all the files,"},"844":{"dur":1,"text":"and package up your app."},"849":{"dur":1,"text":"That means that you can\ndo something like this."},"851":{"dur":4,"text":"You can require this external\ndependency in your code."},"855":{"dur":2,"text":"And typically, you\nwould declare it"},"857":{"dur":2,"text":"like this in your package.json."},"860":{"dur":1,"text":"So when you deploy\nyour Cloud Function,"},"861":{"dur":2,"text":"we will actually run\nNPM install for you."},"864":{"dur":2,"text":"So you don't have to\nresolve those dependencies"},"866":{"dur":3,"text":"and zip them up into a big\nfat ZIP and send them to us."},"869":{"dur":2,"text":"You just send us your source\ncode in your manifest,"},"872":{"dur":1,"text":"and we'll handle the rest."},"879":{"dur":2,"text":"And this is what the deploy\ncommand looks like if you're"},"881":{"dur":3,"text":"using a manifest file."},"885":{"dur":2,"text":"It's the same as it was\nbefore, so nothing changes."},"887":{"dur":2,"text":"We just suck that up and run\nNPM install in the cloud."},"895":{"dur":1,"text":"Logging and monitoring."},"901":{"dur":2,"text":"So from your Cloud\nFunction, you just"},"904":{"dur":2,"text":"write a console.log command\nas you would do normally,"},"907":{"dur":1,"text":"as you would do anywhere else."},"908":{"dur":2,"text":"We will capture that and write\nit to Stackdriver Logging."},"911":{"dur":1,"text":"From Stackdriver\nLogging, you can do"},"912":{"dur":1,"text":"a bunch of interesting things."},"914":{"dur":2,"text":"You can pipe those\nlogs to BigQuery,"},"916":{"dur":3,"text":"you can set up a filter to pipe\nthose logs to a Cloud Pub\/Sub"},"920":{"dur":5,"text":"topic and have another function\nexecute in response to that."},"925":{"dur":3,"text":"If you have an uncalled\nexception in your code,"},"928":{"dur":2,"text":"that will get sent to\nStackdriver Errors."},"930":{"dur":1,"text":"From there, you\ncan set up alerts"},"932":{"dur":2,"text":"to tell you that something's\ngone unusually wrong that we"},"935":{"dur":3,"text":"didn't expect with the function."},"938":{"dur":4,"text":"And all of this is available\nthrough CLI, UI, and API."},"946":{"dur":1,"text":"Monitoring."},"947":{"dur":4,"text":"We report the essential\ntelemetry that you need--"},"951":{"dur":1,"text":"how many times your\nfunction is being"},"952":{"dur":3,"text":"invoked, how long it ran for,\nand how much memory did it use?"},"962":{"dur":3,"text":"OK, what does the environment\nlook like that we run in?"},"965":{"dur":1,"text":"This comes up\nparticularly for those"},"967":{"dur":2,"text":"who might be running\nany native libraries."},"970":{"dur":2,"text":"And by native, I\nmean code that needs"},"972":{"dur":2,"text":"to be compiled against the\nunderlying operating system."},"978":{"dur":3,"text":"So Cloud Functions run\nin an open environment,"},"981":{"dur":4,"text":"meaning that we just have a\nvanilla flavor of Debian Linux."},"986":{"dur":2,"text":"We have a vanilla\nflavor of Node.js."},"988":{"dur":2,"text":"We pre-install ImageMagick\njust because that's"},"990":{"dur":3,"text":"a very commonly\nused native library."},"994":{"dur":1,"text":"We give you a local disk, @\/tmp."},"998":{"dur":2,"text":"Within the environment,\nyou're automatically"},"1000":{"dur":2,"text":"authenticated against\nother Google services,"},"1003":{"dur":2,"text":"so you don't have to bundle\nin any authentication tokens"},"1006":{"dur":2,"text":"or consider how you\nauthenticate your function"},"1009":{"dur":2,"text":"against other services\nin your project."},"1011":{"dur":2,"text":"It's automatically done for you."},"1014":{"dur":2,"text":"And the last point is\nabout the compilation."},"1016":{"dur":2,"text":"Some node modules will\nhave a native component."},"1019":{"dur":1,"text":"And when you run\nNPM install, it's"},"1020":{"dur":1,"text":"going to compile\nthat native code."},"1022":{"dur":2,"text":"If you run NPM install and\nit compiles native code"},"1024":{"dur":3,"text":"on your Mac laptop\nand then you deploy"},"1028":{"dur":5,"text":"to a non-Mac environment,\nyou might have a bad day."},"1034":{"dur":2,"text":"So the advantage of\nhaving NPM install"},"1036":{"dur":4,"text":"run for you is that you just\nhave to name the dependency."},"1040":{"dur":2,"text":"We will run NPM install, we\nwill run the compilation step,"},"1043":{"dur":2,"text":"and by definition, it's going\nto run on the same environment"},"1045":{"dur":1,"text":"that we're going to\nexecute on, so you"},"1047":{"dur":2,"text":"don't run into these\ncrazy incompatibilities."},"1049":{"dur":3,"text":"If the node module you're\nusing doesn't prepackage"},"1053":{"dur":3,"text":"a compilation step, and it\ndepends on some library that"},"1056":{"dur":5,"text":"is not part of the node\nmodule, 9 times out of 10,"},"1061":{"dur":2,"text":"you can go and download\nthe precompiled Debian"},"1064":{"dur":1,"text":"version of that library."},"1066":{"dur":3,"text":"And because it's just a\nstandard Debian environment,"},"1069":{"dur":1,"text":"that should work."},"1070":{"dur":1,"text":"If you really,\nreally, really have"},"1072":{"dur":4,"text":"to compile your own library onto\nthe image, onto the same image,"},"1077":{"dur":2,"text":"then you don't get\nthis image from us,"},"1079":{"dur":1,"text":"you just go get it\nfrom the internet."},"1086":{"dur":1,"text":"Local development."},"1088":{"dur":2,"text":"I've got this environment,\nI'm writing my functions,"},"1090":{"dur":2,"text":"I'm deploying them,\nI'm executing them,"},"1093":{"dur":1,"text":"but it's a little\nslow in the sense"},"1094":{"dur":2,"text":"that I have to go through\nthe whole deploy process"},"1096":{"dur":3,"text":"every time I want\nto make a change."},"1099":{"dur":4,"text":"It'd be great if we gave you a\nlocal emulation environment so"},"1104":{"dur":3,"text":"that you can build and\ntest and iterate and debug"},"1107":{"dur":2,"text":"your functions locally\nbefore you deploy them."},"1110":{"dur":2,"text":"So this is available today."},"1112":{"dur":1,"text":"Just NPM install the emulator."},"1113":{"dur":5,"text":"It runs a simulated environment\nof the cloud environment"},"1119":{"dur":1,"text":"for your Cloud Functions."},"1120":{"dur":2,"text":"It has exactly the\nsame API surface area."},"1123":{"dur":2,"text":"So if you wanted to\nwrite tooling around"},"1125":{"dur":2,"text":"how to deploy\nfunctions using an API,"},"1128":{"dur":1,"text":"that tooling will work\nwith the emulator."},"1130":{"dur":5,"text":"So you can easily switch\nbetween emulator and live code."},"1135":{"dur":1,"text":"And you can debug with this."},"1137":{"dur":2,"text":"So it has a command to\nenable the debugger."},"1139":{"dur":2,"text":"And then you can attach\nyour favorite IDE to that"},"1142":{"dur":1,"text":"and step through\nyour JavaScript code."},"1150":{"dur":1,"text":"Deployment I already\ntouched on a little bit,"},"1151":{"dur":2,"text":"but I want to walk you\nthrough how this works."},"1156":{"dur":1,"text":"So you can deploy inline."},"1158":{"dur":3,"text":"We have an inline\ncode editor in the UI."},"1161":{"dur":4,"text":"Or you can deploy via the\ncommand line or via an API."},"1165":{"dur":2,"text":"If you're deploying directly\nfrom your local file system,"},"1168":{"dur":2,"text":"we'll zip it up for you\nwithout the dependencies,"},"1170":{"dur":1,"text":"or with the\ndependencies if you want"},"1172":{"dur":5,"text":"to send them with us for\nwhichever reason you like."},"1177":{"dur":1,"text":"And we'll send it\nto the API and we'll"},"1178":{"dur":1,"text":"run the build\nprocess from there."},"1180":{"dur":2,"text":"If you don't want to deploy\ndirectly from your local file"},"1183":{"dur":5,"text":"system, you can also deploy\nfrom your GitHub or BitBucket"},"1188":{"dur":1,"text":"repository."},"1190":{"dur":2,"text":"This is done using a tool called\nCloud Source Repositories."},"1193":{"dur":3,"text":"We'll automatically keep in\nsync your Cloud repository"},"1196":{"dur":1,"text":"with your GitHub repository."},"1198":{"dur":2,"text":"And so you're actually deploying\nfrom Cloud Source repos,"},"1200":{"dur":2,"text":"but it is kept in\nsync with GitHub,"},"1202":{"dur":1,"text":"so you don't really have\nto interact with it."},"1204":{"dur":6,"text":"You just commit to GitHub,\nand then trigger a deploy,"},"1210":{"dur":2,"text":"and your Cloud Source\nrepo will sync."},"1218":{"dur":2,"text":"So I want to talk a little\nbit about what actually"},"1220":{"dur":1,"text":"happens at deploy time."},"1222":{"dur":1,"text":"So you've written your code."},"1223":{"dur":1,"text":"Let's say you're using the CLI."},"1225":{"dur":3,"text":"You've gone G Cloud,\nbeta functions, deploy,"},"1229":{"dur":3,"text":"and then what happens?"},"1232":{"dur":2,"text":"So you hit Deploy."},"1234":{"dur":3,"text":"As I said, we zip it\nup if it's in the CLI."},"1238":{"dur":2,"text":"When it gets to the\nserver, we run NPM install."},"1240":{"dur":5,"text":"If there are already\npackages there,"},"1246":{"dur":2,"text":"then we might just\nrun NPM rebuild"},"1248":{"dur":1,"text":"to capture any native\ncompilation that needs"},"1250":{"dur":1,"text":"to happen for the platform."},"1254":{"dur":2,"text":"We have, internally, a\nthing called create version."},"1257":{"dur":1,"text":"So what this is doing\nis saying, OK, we"},"1259":{"dur":1,"text":"have a new version\nof this function."},"1260":{"dur":2,"text":"I'm going to create a new\nversion so the existing"},"1262":{"dur":1,"text":"version continues to exist."},"1266":{"dur":2,"text":"And before we do anything, I'm\ngoing to health check that."},"1268":{"dur":3,"text":"I'm going to make sure\nthat that thing is OK."},"1272":{"dur":1,"text":"That means that the\nenvironment's spun up"},"1273":{"dur":3,"text":"correctly, the image is\nbeing created correctly,"},"1277":{"dur":2,"text":"the runtime has\nstarted correctly."},"1279":{"dur":2,"text":"We can't check that your\nfunction is going to work,"},"1282":{"dur":2,"text":"because your function, of\ncourse, may have side effects."},"1284":{"dur":1,"text":"So we can't invoke\nyour function,"},"1286":{"dur":4,"text":"but we can do everything\nbut that to make sure"},"1290":{"dur":1,"text":"that everything's OK."},"1292":{"dur":2,"text":"And if everything's OK,\nwe'll mark the deployment"},"1294":{"dur":2,"text":"as complete, and\nthen we'll gradually"},"1296":{"dur":2,"text":"move traffic from the old\nversion to the new version."},"1303":{"dur":2,"text":"OK, so that all sounds great."},"1306":{"dur":0,"text":"Now what do I do?"},"1309":{"dur":1,"text":"One of these cases that\npops up quite a lot,"},"1311":{"dur":3,"text":"and I've touched on it a few\ntimes, is lightweight ETL."},"1315":{"dur":4,"text":"So a file comes in, hits\nstorage or comes into the cloud,"},"1319":{"dur":1,"text":"and you want to do some\ntransformation of it"},"1321":{"dur":1,"text":"before it goes somewhere else."},"1323":{"dur":4,"text":"So one solution to that is\nhave the file hit storage"},"1327":{"dur":5,"text":"immediately, have storage\ncall a Cloud Function,"},"1333":{"dur":3,"text":"and maybe from there, you want\nto write it to a database."},"1336":{"dur":2,"text":"Or maybe you want to\nsend it to BigQuery."},"1339":{"dur":1,"text":"Or maybe you just want\nto write back to storage"},"1341":{"dur":1,"text":"with a mutated\nversion of that file."},"1345":{"dur":1,"text":"This comes up in things\nlike image processing,"},"1347":{"dur":4,"text":"video processing, indexing, like\nin my earlier example, entity"},"1352":{"dur":1,"text":"extraction."},"1353":{"dur":2,"text":"You might want to send the\nimage to the vision API"},"1356":{"dur":1,"text":"to pull the entities out of it."},"1358":{"dur":1,"text":"Content sanitation\nand filtering--"},"1359":{"dur":2,"text":"those sorts of things."},"1362":{"dur":1,"text":"Semios is one of the\ncustomers we have"},"1364":{"dur":2,"text":"using Cloud Functions for this."},"1366":{"dur":1,"text":"They're in here because\nI thought they're"},"1368":{"dur":1,"text":"a really interesting use case."},"1369":{"dur":4,"text":"They have around 150,000\nsensors in orchards"},"1374":{"dur":4,"text":"tracking things like temperature\nand pressure, humidity,"},"1379":{"dur":1,"text":"those sorts of things."},"1380":{"dur":1,"text":"And they aggregate all\nthat data in the orchard"},"1382":{"dur":1,"text":"and send it back to the cloud."},"1383":{"dur":2,"text":"And it passes through a Cloud\nFunction on its way through,"},"1386":{"dur":1,"text":"and through that Cloud\nFunction, they're"},"1387":{"dur":2,"text":"doing some filtering before\nit gets to the database."},"1394":{"dur":4,"text":"Another use case we see a\nlot, and I also alluded to,"},"1398":{"dur":2,"text":"is microservices and webhooks."},"1401":{"dur":2,"text":"So there's a few different\nflavors of how this might work."},"1404":{"dur":6,"text":"One is that the client is\ncalling, typically via HTTP,"},"1411":{"dur":1,"text":"the Cloud Function directly."},"1412":{"dur":1,"text":"So the client is\noutside of the cloud,"},"1413":{"dur":1,"text":"the Cloud Function is\ninside of the cloud,"},"1415":{"dur":1,"text":"and they just call it directly."},"1417":{"dur":2,"text":"You can think of this\nas a microservice."},"1419":{"dur":2,"text":"The client may also be inside\nthe cloud in this case."},"1424":{"dur":1,"text":"API."},"1425":{"dur":1,"text":"So similar to a\nmicroservice, but it's"},"1427":{"dur":5,"text":"where the client is\ncalling the Cloud Function"},"1433":{"dur":1,"text":"and treating it as an API."},"1434":{"dur":1,"text":"In the same way that\nyou would if you"},"1436":{"dur":5,"text":"were to build a website\nwith exposed endpoints,"},"1441":{"dur":2,"text":"the mobile client is calling\ndirectly to the Cloud Function."},"1448":{"dur":0,"text":"Webhook."},"1449":{"dur":2,"text":"This is the example\nI gave before where"},"1452":{"dur":2,"text":"somebody like a GitHub\nmight be calling you back,"},"1454":{"dur":2,"text":"or maybe you're sending\nan SMS using Twilio,"},"1457":{"dur":1,"text":"and they're going\nto call you back"},"1458":{"dur":1,"text":"with a webhook when it's done."},"1462":{"dur":3,"text":"So microservices,\ndata ingestion APIs,"},"1465":{"dur":3,"text":"callbacks from\nexternal services."},"1468":{"dur":3,"text":"A good example here is Vroom."},"1472":{"dur":5,"text":"Vroom are the largest\nused car seller on eBay."},"1477":{"dur":1,"text":"And they accept\ndata from partners."},"1479":{"dur":1,"text":"They have a network of partners."},"1480":{"dur":1,"text":"They want to accept data."},"1481":{"dur":4,"text":"They're using Cloud Functions\nas a data ingestion mechanism,"},"1486":{"dur":1,"text":"as an API for their\npartners to call."},"1491":{"dur":1,"text":"And the last one I want\nto talk about today"},"1493":{"dur":2,"text":"is more of a fun use case."},"1495":{"dur":1,"text":"So bots an action."},"1497":{"dur":4,"text":"So this is where some messaging\nclient, some chat client,"},"1501":{"dur":4,"text":"some voice-enabled device is\ngoing to use a Cloud Function"},"1505":{"dur":2,"text":"to create a custom command--"},"1508":{"dur":4,"text":"something to extend the\nbehavior of this tool."},"1512":{"dur":1,"text":"So they'll use\nthe Cloud Function"},"1513":{"dur":5,"text":"for doing this-- typically,\nagain, enabled over HTTP."},"1519":{"dur":2,"text":"Messaging bots-- things\nlike adding custom actions"},"1522":{"dur":4,"text":"to Google Assistant\nand home automation."},"1526":{"dur":1,"text":"So the example here is Meetup."},"1528":{"dur":2,"text":"They created a\ncustom Slack command."},"1530":{"dur":2,"text":"And so when you type this\nSlack command into their Slack"},"1533":{"dur":2,"text":"channel, it will fire\na file function that"},"1535":{"dur":1,"text":"will create a ticket in JIRA."},"1537":{"dur":3,"text":"It's part of their way to\nautomate their development"},"1541":{"dur":0,"text":"processes."},"1546":{"dur":3,"text":"This is my own artistic\ntalent being shown."},"1550":{"dur":1,"text":"It's supposed to be a drum."},"1552":{"dur":3,"text":"And then my wife said that it\nlooked like a bowl of rice."},"1555":{"dur":1,"text":"It's supposed to\nbe a drum, and it's"},"1556":{"dur":3,"text":"supposed to remind me that\nthis is the drum roll."},"1559":{"dur":5,"text":"You may have already heard, but\nwe also now support Firebase."},"1565":{"dur":2,"text":"So you can cause\na Cloud Function"},"1567":{"dur":4,"text":"to be invoked from a mutation in\nthe Firebase real time database"},"1571":{"dur":2,"text":"from life cycle events\non authentication,"},"1574":{"dur":3,"text":"and also from analytics events\nfrom your mobile client."},"1578":{"dur":2,"text":"But I don't want to steal\ntheir thunder too much."},"1586":{"dur":2,"text":"They have a session\ntoday at 4 o'clock."},"1588":{"dur":2,"text":"I encourage you to go\nand have a look at that."},"1590":{"dur":2,"text":"And you can see here\njust those examples"},"1593":{"dur":1,"text":"in the context of Firebase."},"1594":{"dur":2,"text":"So processing payments\nthrough an external provider,"},"1597":{"dur":3,"text":"sending an email or an SMS,\nbackend service integration,"},"1600":{"dur":3,"text":"so connecting to the\nrest of the cloud."},"1604":{"dur":3,"text":"And then funnel optimization\nis leveraging things"},"1608":{"dur":3,"text":"like analytics to know what\nthe end users are doing,"},"1611":{"dur":1,"text":"and to react to that with code."},"1613":{"dur":3,"text":"So a great example might be,\ndepending what the end user is,"},"1617":{"dur":4,"text":"doing, you might want to send\nthem a push notification when"},"1621":{"dur":2,"text":"they enter or exit a\nparticular analytics cohort."},"1629":{"dur":3,"text":"So Cloud Functions\nis in beta today."},"1632":{"dur":2,"text":"It's available for\neveryone to use."},"1635":{"dur":4,"text":"Just go to that URL and\nyou can find out more."},"1639":{"dur":2,"text":"That's all I have\nin terms of content."},"1641":{"dur":2,"text":"Does anyone want to see a demo?"},"1644":{"dur":3,"text":"[APPLAUSE]"},"1649":{"dur":1,"text":"Let me rephrase\nthat-- does anyone"},"1650":{"dur":1,"text":"want to see me try\nto do a demo and have"},"1652":{"dur":4,"text":"it fail catastrophically\nand be embarrassed?"},"1657":{"dur":0,"text":"Yeah, more people."},"1658":{"dur":2,"text":"Great."},"1660":{"dur":2,"text":"OK, switch to demo, please."},"1662":{"dur":1,"text":"OK, this looks confusing."},"1664":{"dur":1,"text":"I'm zoomed out a little bit."},"1666":{"dur":1,"text":"That's why the boxes\nare [INAUDIBLE]."},"1667":{"dur":2,"text":"Let me see if I can make\nthat a little bit better."},"1672":{"dur":0,"text":"That's worse."},"1673":{"dur":2,"text":"OK, we'll live with it."},"1675":{"dur":2,"text":"OK, what are you\nlooking at here?"},"1677":{"dur":2,"text":"All these gray\nboxes at the top--"},"1679":{"dur":5,"text":"you can think of those as\nusers calling your function."},"1684":{"dur":4,"text":"Now, unfortunately, when\nwe were creating this demo,"},"1689":{"dur":2,"text":"we thought it would be easy\njust to run it in a browser."},"1692":{"dur":2,"text":"It turns out the browser\nis not great at generating"},"1694":{"dur":3,"text":"many, many concurrent\nHTTP requests."},"1698":{"dur":3,"text":"So even though there's, I think,\nabout 80 boxes on the screen"},"1701":{"dur":2,"text":"there, we're not talking\n80 concurrent requests."},"1704":{"dur":1,"text":"They're just going\nto fire off requests"},"1705":{"dur":2,"text":"as quickly as they can."},"1708":{"dur":3,"text":"Each little box\nrepresents a request."},"1711":{"dur":1,"text":"When the Cloud\nFunction executes,"},"1713":{"dur":1,"text":"it's just going to do one thing."},"1714":{"dur":1,"text":"It's just going\nto return a color."},"1716":{"dur":3,"text":"And the box is going to render\nthe color that it returns,"},"1719":{"dur":2,"text":"and that's it."},"1722":{"dur":2,"text":"Once we kick this off,\nwe'll see these boxes"},"1724":{"dur":2,"text":"switching color\nto whatever color"},"1726":{"dur":1,"text":"the function is returning."},"1727":{"dur":2,"text":"It's returning the same\ncolor for every one."},"1729":{"dur":1,"text":"Then I'm going to show\nyou the deploy process."},"1731":{"dur":1,"text":"Live, I'm going to\nredeploy a function,"},"1733":{"dur":2,"text":"I'm going to change the\ncolor, and visually, you"},"1735":{"dur":3,"text":"should see all these boxes\nflick over to the new color."},"1738":{"dur":3,"text":"And down below, what\nyou'll see is the latency--"},"1742":{"dur":4,"text":"the median response time\nfrom executing this function."},"1746":{"dur":1,"text":"So let's see if this works."},"1751":{"dur":5,"text":"OK, these are all my\nboxes changing color."},"1756":{"dur":3,"text":"And below, you can\nsee the latency."},"1759":{"dur":4,"text":"Now, I'm going switch\nover to my Cloud console."},"1764":{"dur":1,"text":"Here's my send color function."},"1768":{"dur":1,"text":"I'm just going to edit."},"1773":{"dur":3,"text":"So you can see here, this is\nwhere I'm sending the response."},"1776":{"dur":1,"text":"It's just an HTTP function."},"1777":{"dur":1,"text":"I've got some call\nstuff there just"},"1779":{"dur":1,"text":"to make it callable\nfrom the browser."},"1780":{"dur":2,"text":"Just ignore that."},"1783":{"dur":6,"text":"So I'm going to change this to\nsend green rather than blue."},"1789":{"dur":2,"text":"Hit Save."},"1792":{"dur":1,"text":"And recalling what\nI mentioned before,"},"1793":{"dur":4,"text":"that's going to send that\ndeployment to the cloud."},"1798":{"dur":2,"text":"It's going to run NPM install."},"1800":{"dur":1,"text":"It's going to build an image."},"1802":{"dur":1,"text":"It's going to create a version--"},"1803":{"dur":2,"text":"I better switch across\nso you can see it."},"1806":{"dur":2,"text":"It's going to create a version."},"1808":{"dur":1,"text":"It's going to health\ncheck that version."},"1810":{"dur":2,"text":"And assuming the\nhealth check passes"},"1812":{"dur":4,"text":"and everything's OK, that will\nbecome the current version."},"1817":{"dur":3,"text":"And right on cue--"},"1820":{"dur":4,"text":"right on cue-- it's\ngoing to change."},"1825":{"dur":3,"text":"[APPLAUSE]"},"1834":{"dur":4,"text":"So that's just showing how easy\nit is to deploy a function."},"1839":{"dur":2,"text":"And if you had some\nerror, some problem in it,"},"1841":{"dur":2,"text":"the existing function\nkeeps ticking."},"1843":{"dur":1,"text":"And we will health\ncheck everything,"},"1845":{"dur":2,"text":"and then we'll switch\nacross to the new version."},"1848":{"dur":1,"text":"And you'll notice\nthat the colors"},"1849":{"dur":1,"text":"didn't flick immediately."},"1851":{"dur":1,"text":"That's more a\nbrowser issue, but it"},"1853":{"dur":3,"text":"may be that there's\ntraffic, rather"},"1857":{"dur":1,"text":"requests, that are\ncurrently being served"},"1859":{"dur":2,"text":"will complete before they\nget to the new version."},"1861":{"dur":2,"text":"So you might get some\ntiming issue in that,"},"1864":{"dur":1,"text":"and you saw that\nreflected there."},"1866":{"dur":3,"text":"OK, so that's all I have today."},"1869":{"dur":3,"text":"[MUSIC PLAYING]"}}