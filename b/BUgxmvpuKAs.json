{"2.26":{"start":"2.26","dur":"1.41","text":"Hello, everyone!"},"3.67":{"start":"3.67","dur":"4.16","text":"My name is Artem Boytsov and I&#39;m a Software Engineer at Factual Inc."},"7.83":{"start":"7.83","dur":"4.299","text":"Today I&#39;m going to introduce an\nopen-source tool called Drake."},"12.13":{"start":"12.129","dur":"4.971","text":"We&#39;re at Factual work with data quite a bit.\nWe are a data company."},"17.10":{"start":"17.1","dur":"4.58","text":"We get data from different sources, \nwe clean it, we massage it, we join it"},"21.68":{"start":"21.68","dur":"1.23","text":"with other data,"},"22.91":{"start":"22.91","dur":"3.9","text":"we run machine learning\nalgorithms on it, some clustering algorithms, too,"},"26.81":{"start":"26.81","dur":"3.52","text":"so as you can imagine, our data workflows"},"30.33":{"start":"30.33","dur":"2.46","text":"tend to get quite complicated"},"32.79":{"start":"32.79","dur":"2.13","text":"and they have a lot of steps."},"34.92":{"start":"34.92","dur":"4.35","text":"Drake is our attempt to address some of\nthe issues that we ran into,"},"39.27":{"start":"39.27","dur":"4.28","text":"and we hope other Data Scientists and \nData Engineers will find the tool"},"43.55":{"start":"43.55","dur":"2.37","text":"as useful as we did."},"45.92":{"start":"45.92","dur":"3.62","text":"So I have a window here with my\npresentation and a couple of terminal"},"49.54":{"start":"49.54","dur":"1.68","text":"windows open."},"51.22":{"start":"51.22","dur":"2.61","text":"I will give a short"},"53.83":{"start":"53.83","dur":"4.35","text":"explanation about what Drake is and\nwhy we built it, and then I&#39;ll give a real-time"},"58.18":{"start":"58.18","dur":"2.76","text":"demonstration of what it is like"},"60.94":{"start":"60.94","dur":"1.35","text":"to work with Drake."},"62.29":{"start":"62.29","dur":"2.199","text":"We&#39;ll go over some basic concepts"},"64.49":{"start":"64.489","dur":"2.091","text":"as well as some advanced ones,"},"66.58":{"start":"66.58","dur":"1.179","text":"and then I&#39;ll talk about"},"67.76":{"start":"67.759","dur":"3.301","text":"what else is being in development."},"71.06":{"start":"71.06","dur":"3.38","text":"So, let me maximize this window for the time being"},"74.44":{"start":"74.44","dur":"3.78","text":"and give you some background info."},"78.22":{"start":"78.22","dur":"2.82","text":"Drake is a data workflow management tool,"},"81.04":{"start":"81.04","dur":"2.47","text":"but what is a data workflow?"},"83.51":{"start":"83.51","dur":"1.95","text":"It can looks something like this:"},"85.46":{"start":"85.46","dur":"3.97","text":"you download some data from some source;\nit&#39;s in the wrong format, so you"},"89.43":{"start":"89.43","dur":"2.35","text":"convert it into JSON;"},"91.78":{"start":"91.78","dur":"1.53","text":"there are some bad entries,"},"93.31":{"start":"93.31","dur":"3.159","text":"you get rid of them; then you make some\nother changes to the data;"},"98.51":{"start":"98.51","dur":"2.62","text":"then you copy it to HDFS,"},"101.13":{"start":"101.13","dur":"5.949","text":"and you notice that you haven&#39;t even started\ndoing anything yet, and you already have 5 steps."},"107.08":{"start":"107.079","dur":"1.491","text":"So this could get annoying quite fast"},"111.07":{"start":"111.07","dur":"2.39","text":"and can get out of hand,"},"113.46":{"start":"113.46","dur":"4.52","text":"so we looked at this problem and other\nproblems and tried to identify what"},"117.98":{"start":"117.98","dur":"4.01","text":"the most painful experiences were,"},"121.99":{"start":"121.99","dur":"3.63","text":"and we&#39;ve identified several."},"125.62":{"start":"125.62","dur":"5.04","text":"Being able to reproduce commands that perform \nactions with data is quite important;"},"130.66":{"start":"130.66","dur":"4.86","text":"the locations of the files tend to get\nvery fuzzy when several"},"135.52":{"start":"135.52","dur":"1.429","text":"engineers work on the same project;"},"136.95":{"start":"136.949","dur":"3.58","text":"new versions of the files are created"},"140.53":{"start":"140.529","dur":"2.44","text":"and tossed around; emails and being sent:"},"142.97":{"start":"142.969","dur":"1.571","text":"&quot;Hey, I&#39;ve created this"},"144.54":{"start":"144.54","dur":"2.669","text":"new file in this directory, you should pick it up...&quot;"},"147.21":{"start":"147.209","dur":"5.07","text":"So it can get very messy and a lot of errors \ncan get introduced along the way."},"152.28":{"start":"152.279","dur":"4.1","text":"One alternative is to build a\nprocess-heavy environment where all"},"156.38":{"start":"156.379","dur":"4.85","text":"changes are reflected in some documentation\non the wiki - where everything is stored,"},"161.23":{"start":"161.229","dur":"2.29","text":"locations of the files..."},"163.52":{"start":"163.519","dur":"3.9","text":"But we thought an automated tool\nwould be a much better approach."},"167.42":{"start":"167.419","dur":"1.66","text":"And then finally,"},"169.08":{"start":"169.079","dur":"1.27","text":"when you work with"},"170.35":{"start":"170.349","dur":"2.421","text":"the data and you created your workflow,"},"172.77":{"start":"172.77","dur":"4.74","text":"you oftentimes work on the code as\nwell and make changes to particular steps."},"177.51":{"start":"177.51","dur":"1.37","text":"So once you did that,"},"178.88":{"start":"178.88","dur":"3.699","text":"the step has to be rebuilt as well\nas everything that depends on it."},"182.58":{"start":"182.579","dur":"4.05","text":"But what is exactly? Sometimes it&#39;s\nhard to figure out in a very complicated workflow."},"188.77":{"start":"188.769","dur":"1.291","text":"In production"},"190.06":{"start":"190.06","dur":"1.849","text":"a tool like that can also be very handy."},"191.91":{"start":"191.909","dur":"4.3","text":"There are several issues that anybody who"},"198.01":{"start":"198.01","dur":"2.239","text":"babysat a decently complicated workflow"},"203.82":{"start":"203.82","dur":"1.899","text":"knows to be problematic."},"208.10":{"start":"208.099","dur":"4.79","text":"We need to have retries and resume after failure, there&#39;s status and"},"212.89":{"start":"212.889","dur":"3.86","text":"logs collection, email notifications,\nautomatic backups."},"216.75":{"start":"216.749","dur":"0.98","text":"Lots of different features that"},"220.40":{"start":"220.399","dur":"2.76","text":"any workflow in the company"},"223.16":{"start":"223.159","dur":"5.63","text":"could benefit from if we all used one\nsingle tool that implements them all."},"228.79":{"start":"228.789","dur":"3.44","text":"So, we figured we need something like &quot;make for data&quot;."},"232.23":{"start":"232.229","dur":"2.74","text":"We looked at the existing solutions"},"234.97":{"start":"234.969","dur":"6.77","text":"that mostly designed to build software binaries\nfrom source code, such as make, ant, rake"},"241.74":{"start":"241.739","dur":"0.84","text":"and others, and we found that"},"243.69":{"start":"243.689","dur":"3.63","text":"they lack some features, they lack something that we needed, \nand they don&#39;t give you as much control"},"248.18":{"start":"248.18","dur":"5.279","text":"over the execution as we wanted. \nSo we decided to build our own"},"253.46":{"start":"253.459","dur":"2.121","text":"based on pretty much the same idea."},"255.58":{"start":"255.58","dur":"3.859","text":"The workflow is defined as a number of steps"},"259.44":{"start":"259.439","dur":"2.411","text":"with inputs and outputs,"},"261.85":{"start":"261.85","dur":"4.96","text":"which in turn creates a dependency\ngraph managed by this tool."},"266.81":{"start":"266.81","dur":"1.449","text":"And that allows"},"268.26":{"start":"268.259","dur":"4.481","text":"to organize the data project around one\nsingle file just like a software"},"272.74":{"start":"272.74","dur":"4.969","text":"project on the source code level is\norganized around a make file or a project file,"},"279.14":{"start":"279.139","dur":"2.391","text":"so that any engineer on the project"},"281.53":{"start":"281.53","dur":"1.99","text":"could look up where the files are,"},"283.52":{"start":"283.52","dur":"1.63","text":"reproduce any steps,"},"285.15":{"start":"285.15","dur":"3.079","text":"or modify the workflow."},"288.23":{"start":"288.229","dur":"2.291","text":"So we came up with Drake,"},"290.52":{"start":"290.52","dur":"2.88","text":"and the main design considerations were"},"293.40":{"start":"293.4","dur":"2.859","text":"that we wanted the tool to be"},"296.26":{"start":"296.259","dur":"5.101","text":"as flexible as possible. This is a \ncommand-line tool that can run anything"},"301.36":{"start":"301.36","dur":"1.649","text":"as a child process."},"303.01":{"start":"303.009","dur":"3.181","text":"We wanted it to be smart enough \nto be able to predict"},"306.19":{"start":"306.19","dur":"1.209","text":"what steps will be built,"},"308.78":{"start":"308.779","dur":"3.76","text":"and we wanted to give the users precise\ncontrol over execution, because this"},"313.85":{"start":"313.849","dur":"2.671","text":"was often the most frustrating part:"},"316.52":{"start":"316.52","dur":"3.899","text":"to execute exactly the subset of the\nworkflow that you&#39;re working on"},"320.42":{"start":"320.419","dur":"3.21","text":"or debugging. \nBut most importantly"},"323.63":{"start":"323.629","dur":"2.07","text":"we wanted the tool to be"},"325.70":{"start":"325.699","dur":"2.99","text":"very easy to use,\nwith the reason behind it"},"328.69":{"start":"328.689","dur":"1.371","text":"is that if the tool is not as easy"},"333.43":{"start":"333.43","dur":"2.78","text":"or even the same to use \nas it is to write a bash script,"},"338.02":{"start":"338.02","dur":"3.329","text":"a shell script to run your commands,"},"341.35":{"start":"341.349","dur":"3.141","text":"then this is what the users are going to do."},"344.49":{"start":"344.49","dur":"0.929","text":"And when this shell script"},"348.21":{"start":"348.21","dur":"2.989","text":"is grown to be complicated enough,"},"351.20":{"start":"351.199","dur":"2.331","text":"so that it&#39;s hard to handle, it might"},"353.53":{"start":"353.53","dur":"3.539","text":"have already been too late. \nSo we wanted the user to start"},"357.07":{"start":"357.069","dur":"5.261","text":"using Drake from the very beginning."},"362.33":{"start":"362.33","dur":"7","text":"Let me give you the little demonstration."},"370.92":{"start":"370.919","dur":"1.381","text":"Imagine we have"},"372.30":{"start":"372.3","dur":"4.949","text":"a couple of input files. \nLet&#39;s say we have a list of people"},"377.25":{"start":"377.249","dur":"1.16","text":"with the last name first,"},"380.49":{"start":"380.49","dur":"2.239","text":"first name second, and a phone number"},"382.73":{"start":"382.729","dur":"1.821","text":"in a comma-separated file."},"384.55":{"start":"384.55","dur":"3.75","text":"And we also have a list of skills those\npeople can have"},"388.30":{"start":"388.3","dur":"2.929","text":"with the name of the person in a slightly\ndifferent format"},"391.23":{"start":"391.229","dur":"3.33","text":"(first-name [space] last-name)"},"394.56":{"start":"394.559","dur":"3.801","text":"and the skills that this person has."},"398.36":{"start":"398.36","dur":"3.29","text":"This is, of course, a very simplistic example - \nin real life these could be huge datasets"},"403.20":{"start":"403.199","dur":"3.55","text":"and the steps can be expensive map-reduces."},"409.58":{"start":"409.579","dur":"1.781","text":"But it&#39;s good for demonstration purposes."},"413.16":{"start":"413.159","dur":"2.95","text":"We notice that &quot;skills&quot; is kinda dirty, we&#39;ll need to clean it,"},"417.78":{"start":"417.779","dur":"2.86","text":"so let&#39;s write a very simple"},"420.64":{"start":"420.639","dur":"5.03","text":"data workflow that joins these two files\ntogether and creates one"},"425.67":{"start":"425.669","dur":"1.97","text":"file with person, phone number, and the skill set."},"430.43":{"start":"430.43","dur":"1.15","text":"First of all, we&#39;ll have to remove some"},"435.23":{"start":"435.229","dur":"2.65","text":"bad entries from the &quot;skills&quot; file."},"437.88":{"start":"437.879","dur":"2.29","text":"I&#39;m opening a workflow file"},"440.17":{"start":"440.169","dur":"5.11","text":"named &quot;workflow.d&quot; - this is the default\nworkflow filename that Drake will look for"},"445.28":{"start":"445.279","dur":"3.89","text":"(and of course it can be change from the\ncommand line)."},"449.17":{"start":"449.169","dur":"2.42","text":"So let me type the first step in."},"457.12":{"start":"457.119","dur":"1.63","text":"&quot;skills.filtered&quot;"},"460.74":{"start":"460.74","dur":"3.209","text":"as an output, &quot;skills&quot; as an input,"},"463.95":{"start":"463.949","dur":"4.5","text":"and the commands -  \nindented shell commands."},"470.98":{"start":"470.979","dur":"1.791","text":"We filter out every record"},"472.77":{"start":"472.77","dur":"2.209","text":"that contains substring &quot;BAD&quot;,"},"477.22":{"start":"477.219","dur":"1.151","text":"from $INPUT to $OUTPUT."},"481.31":{"start":"481.309","dur":"1.001","text":"So this is it -"},"482.31":{"start":"482.31","dur":"5.41","text":"we just created the first step. So here we\nspecify one or more output files, specify"},"487.72":{"start":"487.72","dur":"1.809","text":"one ore more input files,"},"489.53":{"start":"489.529","dur":"4.94","text":"and what Drake does is put this\ninformation into environment variables:"},"494.47":{"start":"494.469","dur":"3.91","text":"the number of inputs, $INPUT1, $INPUT2 ..."},"499.14":{"start":"499.139","dur":"3.28","text":"and then it runs this command as a child process."},"502.42":{"start":"502.419","dur":"0.93","text":"A very simple concept."},"504.36":{"start":"504.36","dur":"2.269","text":"So now we run &quot;drake&quot;..."},"506.63":{"start":"506.629","dur":"2.051","text":"It tells us what it&#39;s going to do,"},"508.68":{"start":"508.68","dur":"2.279","text":"which can be suppressed"},"510.96":{"start":"510.959","dur":"3.69","text":"with --auto command-line flag, it also tells\nus why it&#39;s going to do this, and in this"},"514.65":{"start":"514.649","dur":"2.001","text":"case it&#39;s because the output,"},"516.65":{"start":"516.65","dur":"3.58","text":"which is this file, is completely missing."},"520.23":{"start":"520.23","dur":"1.82","text":"Let&#39;s run it."},"522.05":{"start":"522.05","dur":"1.37","text":"Done that."},"523.42":{"start":"523.42","dur":"2.839","text":"Let&#39;s make sure that we have what we want..."},"526.26":{"start":"526.259","dur":"1.941","text":"Yes, so all the bad records"},"528.20":{"start":"528.2","dur":"2.09","text":"were removed from this file."},"530.29":{"start":"530.29","dur":"2.09","text":"Now I need to take care of &quot;people&quot;,"},"532.38":{"start":"532.38","dur":"2.18","text":"and we&#39;ll have to do two things:"},"534.56":{"start":"534.56","dur":"3.75","text":"we&#39;ll have to first convert the name into\nthe format that we desire,"},"538.31":{"start":"538.31","dur":"3.28","text":"which is &quot;first-name [space] last-name&quot;,"},"541.59":{"start":"541.59","dur":"4.3","text":"and then we&#39;ll have to sort it, because\nthis is required for &quot;join&quot;."},"545.89":{"start":"545.89","dur":"2.51","text":"The &quot;skills&quot; file is already sorted,"},"548.40":{"start":"548.4","dur":"1.96","text":"but the &quot;people&quot; file is not."},"550.36":{"start":"550.36","dur":"2.51","text":"So this means that we&#39;ll need to create\ntwo additional steps."},"554.64":{"start":"554.639","dur":"1.071","text":"Let me edit the workflow file,"},"560.33":{"start":"560.33","dur":"4.37","text":"Let&#39;s first take care of the full name -"},"564.70":{"start":"564.7","dur":"2.06","text":"I&#39;m using &quot;awk&quot; for that -"},"574.32":{"start":"574.32","dur":"0.96","text":"...sorry..."},"575.28":{"start":"575.28","dur":"4.78","text":"So, let me print first name first,"},"582.09":{"start":"582.09","dur":"1.63","text":"space, last name then,"},"585.53":{"start":"585.53","dur":"2.46","text":"separator, and phone number."},"592.44":{"start":"592.44","dur":"2.99","text":"$INPUT redirect to $OUTPUT."},"595.43":{"start":"595.43","dur":"3.59","text":"This is the implementation of the first step."},"599.02":{"start":"599.02","dur":"4.16","text":"The implementation of the second step is even simpler than that -"},"603.18":{"start":"603.18","dur":"5.38","text":"we just sort it by name."},"608.56":{"start":"608.56","dur":"1.86","text":"Let me save the workflow..."},"610.42":{"start":"610.42","dur":"2.95","text":"and I run Drake again."},"613.37":{"start":"613.37","dur":"3.75","text":"So now it offers me to run these two steps, \nthe first step doesn&#39;t need to be run"},"617.12":{"start":"617.12","dur":"2.76","text":"because all the files are up-to-date."},"619.88":{"start":"619.88","dur":"2.17","text":"So let me confirm that..."},"622.05":{"start":"622.05","dur":"1.74","text":"Great!"},"623.79":{"start":"623.79","dur":"2.15","text":"Now if I run Drake again,"},"625.94":{"start":"625.94","dur":"3.78","text":"it says that there&#39;s nothing to do,\nbecause everything is up-to-date."},"629.72":{"start":"629.72","dur":"2.97","text":"Let&#39;s take a look at &quot;people.sorted&quot;..."},"632.69":{"start":"632.69","dur":"2.7","text":"Perfect! This is exactly what we wanted."},"635.39":{"start":"635.39","dur":"1.98","text":"So now what we need"},"637.37":{"start":"637.37","dur":"5.33","text":"is just merge them together,"},"642.70":{"start":"642.7","dur":"2.77","text":"And this creates a step"},"645.47":{"start":"645.47","dur":"1.559","text":"that has to input files -"},"649.66":{"start":"649.66","dur":"2.08","text":"the filtered set of skills"},"651.74":{"start":"651.74","dur":"4.16","text":"and the sorted set of people."},"655.90":{"start":"655.9","dur":"7","text":"A simple join, specify the field separator,"},"663.44":{"start":"663.44","dur":"1.94","text":"$INPUTS to $OUTPUT."},"665.38":{"start":"665.38","dur":"1.79","text":"So this variable, $INPUTS, contains"},"668.82":{"start":"668.82","dur":"3.83","text":"all the input files given"},"674.56":{"start":"674.56","dur":"1.93","text":"in space-separated form."},"676.49":{"start":"676.49","dur":"3.57","text":"Let me also print something just for\ndebugging purposes and also"},"680.06":{"start":"680.06","dur":"7","text":"to demonstrate what environment variables Drake sets up."},"696.83":{"start":"696.83","dur":"1.51","text":"Let me save the workflow,"},"699.97":{"start":"699.97","dur":"2.22","text":"and then run Drake again."},"702.19":{"start":"702.19","dur":"2","text":"It only offers to"},"704.19":{"start":"704.19","dur":"3.22","text":"build one target because \neverything else is up-to-date."},"707.41":{"start":"707.41","dur":"2.51","text":"Let me confirm that..."},"709.92":{"start":"709.92","dur":"2.98","text":"Here&#39;s the debugging output, number of inputs - 2,"},"712.90":{"start":"712.9","dur":"5.52","text":"and this is the variable that contains \nall inputs, not just the first one,"},"718.42":{"start":"718.42","dur":"4.82","text":"and as you can see, Drake fully\nqualifies the filename with the absolute path."},"724.84":{"start":"724.84","dur":"3.17","text":"Let&#39;s take a look at the output..."},"728.01":{"start":"728.01","dur":"3.85","text":"Great! This is exactly what we wanted to.\nSo that&#39;s all our workflow,"},"731.86":{"start":"731.86","dur":"1.219","text":"and we could have"},"733.08":{"start":"733.079","dur":"5.161","text":"put it in a linear bash script, but now we\nhave so much more flexibility and this"},"738.24":{"start":"738.24","dur":"2.17","text":"is what I&#39;m going to show next."},"740.41":{"start":"740.41","dur":"1.47","text":"I would like to show you also that"},"743.49":{"start":"743.49","dur":"3.25","text":"Drake saves stderr and stdout"},"747.50":{"start":"747.5","dur":"3.05","text":"of the child process into a special directory."},"750.55":{"start":"750.55","dur":"5.5","text":"It creates a directory for each step,"},"756.05":{"start":"756.05","dur":"2.84","text":"and this is the last step, for example,"},"758.89":{"start":"758.89","dur":"3.18","text":"the name is based off the name of the\nabsolute output file."},"763.56":{"start":"763.56","dur":"7","text":"So let&#39;s cd into that..."},"775.99":{"start":"775.99","dur":"4.05","text":"If we &quot;cat&quot; this file..."},"780.04":{"start":"780.04","dur":"2.94","text":"This is our debugging input"},"782.98":{"start":"782.98","dur":"4.25","text":"and Drake also saves all the variables that were given"},"787.23":{"start":"787.23","dur":"3.67","text":"to the child process"},"790.90":{"start":"790.9","dur":"4","text":"just for debugging sake."},"794.90":{"start":"794.9","dur":"1.4","text":"O&#39;key,"},"796.30":{"start":"796.3","dur":"3.83","text":"so what we did is created a very simple \nworkflow that looks something like this:"},"800.13":{"start":"800.13","dur":"7","text":"&quot;skills.filtered&quot;, there are two steps here and then the join."},"807.70":{"start":"807.7","dur":"6.52","text":"What make Drake very useful is how\nmuch control over execution you have."},"814.22":{"start":"814.22","dur":"1.73","text":"So right now there would be nothing to do."},"815.95":{"start":"815.95","dur":"0.95","text":"If you invalidate some file -"},"816.90":{"start":"816.9","dur":"2.7","text":"if you &quot;touch&quot; it"},"821.58":{"start":"821.58","dur":"3.39","text":"and change its timestamp,"},"824.97":{"start":"824.97","dur":"1.819","text":"as any make-like system"},"826.79":{"start":"826.789","dur":"0.961","text":"it will calculate what else needs to be done."},"830.46":{"start":"830.46","dur":"1.3","text":"And notice that"},"831.76":{"start":"831.76","dur":"3.54","text":"it will do &quot;people.fullname&quot;"},"837.07":{"start":"837.07","dur":"4.11","text":"because the file is not as fresh as it\nshould be - it&#39;s out-of-date,"},"841.18":{"start":"841.18","dur":"3.24","text":"but the other targets will be built"},"844.42":{"start":"844.42","dur":"2.239","text":"because they are projected to be,"},"846.66":{"start":"846.659","dur":"1.571","text":"Drake doesn&#39;t know yet"},"848.23":{"start":"848.23","dur":"1.87","text":"that it will need to build these,"},"850.10":{"start":"850.1","dur":"2.15","text":"but it thinks that it will."},"852.25":{"start":"852.25","dur":"2.07","text":"If we do this..."},"854.32":{"start":"854.32","dur":"1.2","text":"O&#39;key, all of them are built,"},"855.52":{"start":"855.52","dur":"2.54","text":"I run Drake again - there&#39;s nothing to do."},"858.06":{"start":"858.06","dur":"5.96","text":"But also what I can do is force the rebuild of everything."},"864.02":{"start":"864.02","dur":"1.659","text":"&quot;...&quot; is a target that matches"},"867.61":{"start":"867.61","dur":"4.47","text":"all existing steps and &quot;+&quot; means"},"872.08":{"start":"872.08","dur":"3.22","text":"forcibly rebuild the targets."},"875.30":{"start":"875.3","dur":"7","text":"So you see that it shows that it will build\neverything in the &quot;forced&quot; mode."},"883.28":{"start":"883.28","dur":"4.79","text":"You can also specify only one target\nto be rebuilt, let&#39;s say, we want to build"},"888.07":{"start":"888.07","dur":"1.8","text":"this particular step."},"889.87":{"start":"889.87","dur":"1.97","text":"So, in &quot;forced&quot; mode,"},"891.84":{"start":"891.84","dur":"1.529","text":"I want to specify"},"893.37":{"start":"893.369","dur":"7","text":"that only this target should be build,\nand for this I use the &quot;=&quot; symbol."},"900.66":{"start":"900.66","dur":"4.68","text":"Only one target..."},"905.34":{"start":"905.34","dur":"1.88","text":"You can also do exclusions,"},"908.75":{"start":"908.75","dur":"1.28","text":"for example,"},"910.03":{"start":"910.03","dur":"2.81","text":"I want to build everything"},"913.88":{"start":"913.879","dur":"2.081","text":"except this one particular target,"},"915.96":{"start":"915.96","dur":"5.64","text":"which is, let&#39;s say, &quot;people.fullname&quot;."},"921.60":{"start":"921.6","dur":"7","text":"So you see that all the targets \nare listed except this one."},"930.56":{"start":"930.56","dur":"2.899","text":"A very common scenario is when you"},"933.46":{"start":"933.459","dur":"4.33","text":"change something in one of the steps, \nand as a result, you want rebuild"},"937.79":{"start":"937.789","dur":"1.261","text":"this step and everything that depends on it."},"941.35":{"start":"941.35","dur":"3.92","text":"So let&#39;s say that we changed something here,"},"945.27":{"start":"945.27","dur":"3.48","text":"in this command - I won&#39;t really change it,\nbut let&#39;s say that we did."},"948.75":{"start":"948.75","dur":"4.41","text":"This means that we need to rebuild\nthis particular step and everything"},"953.16":{"start":"953.16","dur":"2.469","text":"that depends on it directly or indirectly."},"955.63":{"start":"955.629","dur":"1.241","text":"So for that Drake has"},"958.36":{"start":"958.36","dur":"7","text":"what we call a &quot;down-tree&quot; mode."},"969.05":{"start":"969.05","dur":"1.609","text":"It&#39;s turned on by using the &quot;^&quot; symbol."},"975.61":{"start":"975.61","dur":"1.419","text":"So this command were forcibly rebuild"},"977.03":{"start":"977.029","dur":"2.75","text":"the target &quot;people.fullname&quot;"},"980.91":{"start":"980.91","dur":"3.19","text":"and everything that depends on it."},"984.10":{"start":"984.1","dur":"5.54","text":"As you see, &quot;people.fullname&quot;, \n&quot;people.sorted&quot;, &quot;output&quot;."},"989.64":{"start":"989.64","dur":"4.6","text":"And the reason we chose &quot;^&quot; symbol is \nbecause it reminded us of a little tree -"},"996.01":{"start":"996.01","dur":"2.08","text":"so this tree"},"998.09":{"start":"998.09","dur":"3.22","text":"with the target on top and\ntwo targets that depend on it"},"1001.31":{"start":"1001.31","dur":"1.12","text":"kinda looks the same,"},"1003.25":{"start":"1003.25","dur":"4.59","text":"this is why we use it."},"1007.84":{"start":"1007.84","dur":"4.9","text":"So, we built a very simple workflow and\nI demonstrated all the flexibility"},"1012.74":{"start":"1012.74","dur":"6.02","text":"of the fine-grained control over what\nexactly will be executed."},"1018.76":{"start":"1018.76","dur":"3","text":"Now you might say that this workflow is very simple"},"1021.76":{"start":"1021.76","dur":"2.32","text":"and you need a sophisticated tool"},"1024.08":{"start":"1024.08","dur":"3.28","text":"like Drake to be able to handle that."},"1027.36":{"start":"1027.36","dur":"3.069","text":"But this is an example of \na real-life workflow"},"1030.43":{"start":"1030.429","dur":"3.61","text":"on one of our data projects."},"1034.04":{"start":"1034.039","dur":"2.951","text":"It&#39;s a dependency graph created based on"},"1036.99":{"start":"1036.99","dur":"2.599","text":"a Drake workflow file using graphviz"},"1039.59":{"start":"1039.589","dur":"3.521","text":"by one of our software engineers, \nand as you can see, it&#39;s not easy"},"1043.11":{"start":"1043.11","dur":"1.99","text":"to manage it all. We have"},"1045.10":{"start":"1045.1","dur":"3.779","text":"targets that have multiple outputs,\ntargets that have multiple inputs,"},"1048.88":{"start":"1048.879","dur":"2.001","text":"and it&#39;s getting quite complicated."},"1050.88":{"start":"1050.88","dur":"4.12","text":"So managing it without a tool like Drake \ncan be a real nightmare,"},"1055.00":{"start":"1055","dur":"2.7","text":"unless, of course, \nall the steps here are trivial"},"1057.70":{"start":"1057.7","dur":"1.56","text":"and re-running the whole workflow"},"1061.57":{"start":"1061.57","dur":"5.79","text":"has no cost whatsoever."},"1067.36":{"start":"1067.36","dur":"2.45","text":"Returning to our workflow,"},"1069.81":{"start":"1069.81","dur":"2.41","text":"the standard syntax of &quot;drake&quot;"},"1072.22":{"start":"1072.22","dur":"4","text":"is the list of target selection\nexpressions, which can be one or several,"},"1076.22":{"start":"1076.22","dur":"5.73","text":"and each target selection is the name of\nthe output file, let&#39;s say, &quot;people.sorted&quot;"},"1081.95":{"start":"1081.95","dur":"5.01","text":"and, for example, &quot;skills.filtered&quot;,"},"1086.96":{"start":"1086.96","dur":"3.87","text":"and one or several modifiers. \nSo, for example, this modifier says that"},"1090.83":{"start":"1090.83","dur":"1.41","text":"&quot;I don&#39;t care about any dependencies,"},"1092.24":{"start":"1092.24","dur":"4.08","text":"just build this target and nothing else&quot;,"},"1096.32":{"start":"1096.32","dur":"2.97","text":"this would say &quot;I don&#39;t care about\ntimestamps as well,"},"1099.29":{"start":"1099.29","dur":"7","text":"please build it regardless of whether\nit&#39;s up-to-date or not&quot;."},"1106.37":{"start":"1106.37","dur":"4.28","text":"If I remove this, Drake would still say there&#39;s\nnothing to do because all the targets"},"1110.65":{"start":"1110.65","dur":"2.6","text":"are up-to-date."},"1113.25":{"start":"1113.25","dur":"2.03","text":"And not only several"},"1115.28":{"start":"1115.28","dur":"3.42","text":"targets can be specified, but you can use\nregular expressions as well,"},"1118.70":{"start":"1118.7","dur":"1.51","text":"for example, this would build everything"},"1123.64":{"start":"1123.64","dur":"4.12","text":"that contains the word &quot;people&quot;, i.e. every step \nthat has at least one output that contains"},"1127.76":{"start":"1127.76","dur":"1.12","text":"the word &quot;people&quot;,"},"1128.88":{"start":"1128.88","dur":"3.85","text":"which would in our case \nmatch these two steps."},"1132.73":{"start":"1132.73","dur":"5.78","text":"And you can also use tags, \nand this is my next topic."},"1138.51":{"start":"1138.51","dur":"1.169","text":"So, imagine for a second \nthat you need to"},"1142.60":{"start":"1142.6","dur":"4.5","text":"run some statistics on some of the\noutputs in our workflow."},"1147.10":{"start":"1147.1","dur":"2.79","text":"Let&#39;s say, something very simple"},"1149.89":{"start":"1149.89","dur":"4.34","text":"like calculate the number of lines \nand output it to the console."},"1154.23":{"start":"1154.23","dur":"4.69","text":"In real life, of course, it \nwould get more complicated."},"1158.92":{"start":"1158.92","dur":"3.89","text":"But you need to define another step, it doesn&#39;t\nhave any outputs, because it doesn&#39;t create"},"1162.81":{"start":"1162.81","dur":"3.31","text":"any files, but it does have an input,\nwhich is our final result,"},"1169.16":{"start":"1169.159","dur":"3.321","text":"and let&#39;s just do something silly like"},"1172.48":{"start":"1172.48","dur":"1.91","text":"output the number of lines."},"1174.39":{"start":"1174.39","dur":"3.93","text":"O&#39;key, so this is fine, but how do you\ninvoke such a step?"},"1178.32":{"start":"1178.32","dur":"3.74","text":"And the answer is to use a tag."},"1182.06":{"start":"1182.06","dur":"3.01","text":"Tags are special names prepended by &quot;%&quot; sign"},"1190.06":{"start":"1190.06","dur":"4.48","text":"and they can be used to invoke specific steps.\nLet&#39;s do the same thing for &quot;people.sorted&quot;."},"1204.92":{"start":"1204.919","dur":"7","text":"And we just modified our workflow and\ncreated two little branches like these."},"1216.90":{"start":"1216.9","dur":"1.74","text":"...this is just a typo..."},"1218.64":{"start":"1218.64","dur":"7","text":"...let me fix it..."},"1226.39":{"start":"1226.39","dur":"3.5","text":"So it prints the number of lines."},"1229.89":{"start":"1229.89","dur":"7","text":"Or we can specify both of them."},"1238.05":{"start":"1238.05","dur":"1.53","text":"So, this file is not up-to-date,"},"1239.58":{"start":"1239.58","dur":"2.16","text":"because we just tinkered with it,"},"1241.74":{"start":"1241.74","dur":"7","text":"so let&#39;s build it first"},"1248.76":{"start":"1248.76","dur":"3.54","text":"and I will demonstrate what I wanted to."},"1252.30":{"start":"1252.3","dur":"0.93","text":"So this would match two steps."},"1256.65":{"start":"1256.65","dur":"4.469","text":"Tags are first-class citizens in Drake, \nmeaning that"},"1261.12":{"start":"1261.119","dur":"5.04","text":"you can do anything that you do with\noutput filenames with tags and,"},"1266.16":{"start":"1266.159","dur":"4.27","text":"for example, you can use regular expressions."},"1270.43":{"start":"1270.429","dur":"2.551","text":"This would match"},"1272.98":{"start":"1272.98","dur":"1.84","text":"all the targets that have"},"1274.82":{"start":"1274.82","dur":"2.78","text":"a tag that contains the word &quot;stats&quot;,"},"1277.60":{"start":"1277.6","dur":"2.02","text":"or you can also do &quot;forced&quot; mode."},"1287.21":{"start":"1287.21","dur":"4.199","text":"Since I re-evaluate this target in\nthe &quot;forced&quot; mode, it means that"},"1291.41":{"start":"1291.409","dur":"3.561","text":"this target has to be built from scratch,\nand every that it depends on will be"},"1294.97":{"start":"1294.97","dur":"1.81","text":"rebuilt."},"1296.78":{"start":"1296.78","dur":"2.28","text":"It means all of these"},"1299.06":{"start":"1299.06","dur":"4.31","text":"targets will be rebuilt and then\n&quot;%stats.output&quot; will be rebuilt."},"1303.37":{"start":"1303.37","dur":"6.35","text":"Or you can also use &quot;down-tree&quot; mode or\nexclusions or anything like that."},"1309.72":{"start":"1309.72","dur":"1.65","text":"Also,"},"1311.37":{"start":"1311.37","dur":"4.86","text":"you can specify multiple tags, and \ndifferent steps can share the same tag."},"1317.89":{"start":"1317.89","dur":"3","text":"For example,"},"1320.89":{"start":"1320.89","dur":"2.86","text":"I could create a tag name &quot;%all_stats&quot;"},"1323.75":{"start":"1323.75","dur":"6.06","text":"and give it to every step \nthat generates statistics,"},"1329.81":{"start":"1329.81","dur":"1.75","text":"and then I don&#39;t have to use\nregular expressions, I can just"},"1333.92":{"start":"1333.92","dur":"4.499","text":"refer to this tag directly."},"1338.42":{"start":"1338.419","dur":"2.951","text":"This can be very convenient, \nbecause you can give"},"1341.37":{"start":"1341.37","dur":"5.08","text":"specific tags to certain subsets of your\noverall workflow that can be easily invoked."},"1351.28":{"start":"1351.28","dur":"5.48","text":"Another cool thing about tags is that \nthey can depend upon each other,"},"1356.76":{"start":"1356.76","dur":"4.95","text":"which allows you to create dependencies\nnot through input and output files, but"},"1361.71":{"start":"1361.71","dur":"2.59","text":"through tags. For example,"},"1364.30":{"start":"1364.3","dur":"2.879","text":"tag %b depends on tag %a"},"1367.18":{"start":"1367.179","dur":"3.671","text":"(this step doesn&#39;t even have\nany input or output files),"},"1370.85":{"start":"1370.85","dur":"5.35","text":"tag %c depends on tag %b,\nand this is, let&#39;s say, step 2,"},"1376.20":{"start":"1376.2","dur":"6.23","text":"and then tag %d depends on tag %c,\nand this is, let&#39;s say, step 3."},"1382.43":{"start":"1382.43","dur":"2.55","text":"Now if run it in the &quot;forced&quot; mode,"},"1384.98":{"start":"1384.98","dur":"4.53","text":"if I run evaluation of &quot;%d&quot; in the &quot;forced&quot; mode,"},"1389.51":{"start":"1389.51","dur":"2.1","text":"it will also pull"},"1393.47":{"start":"1393.47","dur":"3.14","text":"the first step and the second step,\nthen the third step."},"1396.61":{"start":"1396.61","dur":"4","text":"One, two, three. Now the reason I have to\nrun it in &quot;forced&quot; mode is because there are no"},"1400.61":{"start":"1400.61","dur":"4.12","text":"input and output files, and there&#39;s no\nsuch thing as timestamp-based"},"1404.73":{"start":"1404.73","dur":"4","text":"dependency resolution, so it doesn&#39;t even\nknow what to do - by default"},"1408.73":{"start":"1408.73","dur":"1.439","text":"it would not run it at all."},"1410.17":{"start":"1410.169","dur":"3.681","text":"And, of course, you can do all sorts of\nstuff that we discussed before, for example,"},"1413.85":{"start":"1413.85","dur":"3.75","text":"you can exclude the middle step,"},"1420.12":{"start":"1420.12","dur":"5.29","text":"or you can run, let&#39;s say, only \na specific target,"},"1425.41":{"start":"1425.41","dur":"3.58","text":"like only the second step,"},"1431.66":{"start":"1431.66","dur":"3.49","text":"and you can use all the variety of\ntarget selection mechanisms that we"},"1435.15":{"start":"1435.15","dur":"2.98","text":"covered before."},"1438.13":{"start":"1438.13","dur":"3.24","text":"Now let&#39;s imagine that I want to do\na little experiment."},"1441.37":{"start":"1441.37","dur":"3.04","text":"Let me remove this..."},"1444.41":{"start":"1444.41","dur":"4.55","text":"and this,"},"1448.96":{"start":"1448.96","dur":"6.48","text":"and this. And the experiment is I want to\nmake some change"},"1455.44":{"start":"1455.44","dur":"2.32","text":"in &quot;people.fullname&quot;, for example."},"1457.76":{"start":"1457.76","dur":"2.78","text":"I want to replace"},"1462.01":{"start":"1462.01","dur":"4.48","text":"dashes in the phone numbers with\nsomething else, like &quot;equals&quot; signs,"},"1467.87":{"start":"1467.87","dur":"2.94","text":"or something equally silly, but this is for\ndemonstration purposes only."},"1472.54":{"start":"1472.54","dur":"4.05","text":"So, I will change this command to\nreplace all the dashes with &quot;equals&quot; signs"},"1477.41":{"start":"1477.409","dur":"1.27","text":"in field #3, which is the phone number,"},"1480.44":{"start":"1480.44","dur":"4.08","text":"and I save the workflow. \nNow if I just re-run everything,"},"1484.52":{"start":"1484.52","dur":"2.6","text":"then I will overwrite the existing files."},"1487.12":{"start":"1487.12","dur":"2.429","text":"What if I want to have \nsome sort of an experimental result"},"1492.23":{"start":"1492.23","dur":"2.199","text":"and see if I like it."},"1494.43":{"start":"1494.429","dur":"5.381","text":"This is where data branching comes in. \nSo what I can do is"},"1499.81":{"start":"1499.81","dur":"3.68","text":"run my current command \nin a specific branch."},"1503.49":{"start":"1503.49","dur":"4.23","text":"And because I changed this step,\nwhat I&#39;lll have to do"},"1508.55":{"start":"1508.549","dur":"1.521","text":"is to tell Drake to force-rebuild this step"},"1514.49":{"start":"1514.49","dur":"4.65","text":"in &quot;down-tree&quot; mode, meaning this step and\neverything that depends on it,"},"1519.14":{"start":"1519.14","dur":"1.27","text":"because the timestamps of the existing files"},"1522.91":{"start":"1522.909","dur":"2.711","text":"are still up-to-date."},"1525.62":{"start":"1525.62","dur":"2.97","text":"&quot;forced&quot; mode, &quot;down-tree&quot;, &quot;people.fullname&quot;."},"1534.77":{"start":"1534.77","dur":"2.12","text":"Yes."},"1536.89":{"start":"1536.89","dur":"5.92","text":"And now because I specified a branch,\nevery file that is created as a result"},"1542.81":{"start":"1542.81","dur":"3.27","text":"of this command will be given"},"1546.08":{"start":"1546.08","dur":"3.05","text":"a suffix and it will be created in this branch."},"1549.13":{"start":"1549.13","dur":"3.38","text":"So, &quot;people.fullname#exp&quot; used\nthe original file, &quot;people&quot; as its input,"},"1556.64":{"start":"1556.64","dur":"1.279","text":"but then after that,\neverything below that"},"1559.54":{"start":"1559.539","dur":"6.051","text":"used the branch versions as their input, and\nas a result we created a kinda parallel subtree."},"1566.31":{"start":"1566.31","dur":"2.32","text":"And, finally, &quot;output&quot;, which is a join,"},"1570.44":{"start":"1570.44","dur":"2.83","text":"used the branch version of &quot;people.sorted&quot;,"},"1573.27":{"start":"1573.27","dur":"4.42","text":"but the regular version of &quot;skills.filtered&quot;,\nbecause it didn&#39;t change in this branch."},"1577.69":{"start":"1577.69","dur":"2.989","text":"So if we take a look at the output now,"},"1580.68":{"start":"1580.679","dur":"2.22","text":"we&#39;lll see that this change that we made"},"1582.90":{"start":"1582.899","dur":"1.821","text":"propagated all the way over here."},"1586.44":{"start":"1586.44","dur":"1.56","text":"And now I may want to"},"1589.16":{"start":"1589.159","dur":"5.431","text":"abandon this branch completely, and then\nall I have to do is just delete"},"1594.59":{"start":"1594.59","dur":"2.06","text":"all the files with the suffix,"},"1596.65":{"start":"1596.65","dur":"5.09","text":"or I can merge the\nbranch back into the trunk"},"1601.74":{"start":"1601.74","dur":"1.73","text":"by using --branch-merge option."},"1607.95":{"start":"1607.95","dur":"3.48","text":"I give the name of the branch and then\nI give what they want to merge, and by"},"1611.43":{"start":"1611.43","dur":"7","text":"default that would apply to all files."},"1622.12":{"start":"1622.12","dur":"5.22","text":"...I apologize that&#39;s --merge-branch, \nnot --branch-merge..."},"1627.34":{"start":"1627.34","dur":"3.76","text":"And by default it would apply to all files,\nand Drake will warn us that"},"1631.10":{"start":"1631.1","dur":"1.54","text":"it will move this file to the trunk,"},"1633.60":{"start":"1633.6","dur":"2.569","text":"this file to the trunk, and \nthis file to the trunk."},"1636.17":{"start":"1636.169","dur":"1.691","text":"But I can also use target selection"},"1637.86":{"start":"1637.86","dur":"4.03","text":"to specify what exactly I want to move."},"1641.89":{"start":"1641.89","dur":"5.639","text":"Maybe just this guy."},"1647.53":{"start":"1647.529","dur":"2.201","text":"And then everything else."},"1649.73":{"start":"1649.73","dur":"1.329","text":"Everything - just two left."},"1655.45":{"start":"1655.45","dur":"3.93","text":"And now the output is the same version\nthat we created and if I just run &quot;drake&quot;"},"1659.38":{"start":"1659.38","dur":"4.06","text":"it will tell that there&#39;s nothing to do, \nbecause all the files are up-to-date,"},"1663.44":{"start":"1663.44","dur":"1.18","text":"and every output has a fresher\ntimestamp than the input."},"1669.49":{"start":"1669.49","dur":"4.35","text":"Now we covered quite a lot, we covered \nmost of basic functionality: target selection"},"1673.84":{"start":"1673.84","dur":"3.23","text":"dependency resolution, branching, tags,"},"1677.07":{"start":"1677.07","dur":"4.06","text":"and I would like to go over some\nfeatures that are not as important"},"1681.13":{"start":"1681.13","dur":"2.96","text":"but still pretty cool."},"1684.09":{"start":"1684.09","dur":"5.03","text":"So first of all, Drake does support HDFS.\nWhat it means is that Drake"},"1689.12":{"start":"1689.12","dur":"4.77","text":"can look at HDFS files and\ncompare their timestamps to local files or"},"1693.89":{"start":"1693.89","dur":"1.95","text":"other HDFS files"},"1695.84":{"start":"1695.84","dur":"2.29","text":"and resolve dependencies this way."},"1698.13":{"start":"1698.13","dur":"2.56","text":"And it also supports partial files"},"1700.69":{"start":"1700.69","dur":"3.08","text":"that Hadoop generates, so when you \ngive Drake a directory,"},"1705.84":{"start":"1705.84","dur":"3.3","text":"a map-reduce output for example,\nthen it will look at all the partial files"},"1709.14":{"start":"1709.14","dur":"3.68","text":"and make sure that the youngest\nfile in the output directory"},"1714.71":{"start":"1714.71","dur":"1.61","text":"is still fresher that the oldest file\nin the input directory."},"1719.62":{"start":"1719.62","dur":"1.84","text":"The other way around, I&#39;m sorry."},"1721.46":{"start":"1721.46","dur":"3.959","text":"Let me demonstrate this,\nlet&#39;s say that"},"1725.42":{"start":"1725.419","dur":"3.87","text":"&quot;output&quot; is not the final destination, we\nwant &quot;output&quot; to be copied"},"1729.29":{"start":"1729.289","dur":"3.571","text":"to HDFS where some further \nprocessing will take place."},"1732.86":{"start":"1732.86","dur":"3.85","text":"So what I want to do is create another step,"},"1736.71":{"start":"1736.71","dur":"1.65","text":"and this time my output"},"1738.36":{"start":"1738.36","dur":"2.049","text":"is on the HDFS filesystem."},"1740.41":{"start":"1740.409","dur":"3.4","text":"hdfs: is a filesystem prefix."},"1743.81":{"start":"1743.809","dur":"1.011","text":"As you might have guessed,"},"1744.82":{"start":"1744.82","dur":"3.979","text":"I didn&#39;t need to use a prefix before\nbecause the default prefix is"},"1748.80":{"start":"1748.799","dur":"2.801","text":"the local filesystem."},"1751.60":{"start":"1751.6","dur":"2.9","text":"And then I&#39;ll need to copy it \nusing &quot;hadoop&quot; binary."},"1754.50":{"start":"1754.5","dur":"3.62","text":"I copy $INPUT into $OUTPUT."},"1758.12":{"start":"1758.12","dur":"2.99","text":"Because &quot;hadoop&quot; doesn&#39;t really"},"1761.11":{"start":"1761.11","dur":"3.26","text":"have an overwrite option, \nI will also have to remove"},"1764.37":{"start":"1764.37","dur":"2.55","text":"the old output"},"1766.92":{"start":"1766.92","dur":"3.13","text":"and suppress any errors if I get them."},"1770.05":{"start":"1770.05","dur":"1.83","text":"So now I saved the workflow"},"1774.19":{"start":"1774.19","dur":"1.63","text":"and let me run it."},"1775.82":{"start":"1775.82","dur":"4.1","text":"Everything in this workflow was\nup-to-date except this new step,"},"1779.92":{"start":"1779.92","dur":"1.96","text":"which we just added."},"1781.88":{"start":"1781.88","dur":"1.56","text":"Confirm..."},"1783.44":{"start":"1783.44","dur":"3.27","text":"Now this file..."},"1786.71":{"start":"1786.71","dur":"2.46","text":"...sorry, I made a little mistake..."},"1789.17":{"start":"1789.17","dur":"1.46","text":"...this is wrong..."},"1790.63":{"start":"1790.63","dur":"1.58","text":"...this is right..."},"1792.21":{"start":"1792.21","dur":"4.34","text":"...this is the correct command for removing..."},"1796.55":{"start":"1796.55","dur":"7","text":"Let me run it again..."},"1804.79":{"start":"1804.79","dur":"3.24","text":"Copying to HDFS... done."},"1808.03":{"start":"1808.03","dur":"3.33","text":"Now if I run it again it will say that\neverything is up-to-date,"},"1811.36":{"start":"1811.36","dur":"4.98","text":"because the HDFS file is younger. \nSo let me &quot;touch&quot; one of the inputs that"},"1816.34":{"start":"1816.34","dur":"1.03","text":"we have, let&#39;s say, &quot;skills&quot;."},"1820.25":{"start":"1820.25","dur":"3.28","text":"It will result in generating new &quot;skills.filtered&quot;,"},"1823.53":{"start":"1823.53","dur":"1.67","text":"new &quot;output&quot;,"},"1825.20":{"start":"1825.2","dur":"5.26","text":"and of course, copying &quot;output&quot; to HDFS."},"1830.46":{"start":"1830.46","dur":"2.4","text":"Which is very nice because if"},"1832.86":{"start":"1832.86","dur":"2.539","text":"one of your steps is local"},"1835.40":{"start":"1835.399","dur":"3.871","text":"and another is on HDFS, then it \nwould be nice to have some tool"},"1840.46":{"start":"1840.46","dur":"1.11","text":"to handle exactly if the copy has\nto take place or not."},"1845.53":{"start":"1845.53","dur":"1.229","text":"So, the other thing"},"1846.76":{"start":"1846.759","dur":"4.961","text":"that I would like to mention is\nthat targets don&#39;t have to have"},"1851.72":{"start":"1851.72","dur":"4.06","text":"inputs or outputs, there could be\na target that doesn&#39;t have"},"1855.78":{"start":"1855.78","dur":"2.08","text":"any inputs, for example,"},"1857.86":{"start":"1857.86","dur":"2.74","text":"if you want to download something from the Web,"},"1860.60":{"start":"1860.6","dur":"2.569","text":"or from any other source for that reason,"},"1863.17":{"start":"1863.169","dur":"3.331","text":"then this target doesn&#39;t have any input."},"1866.50":{"start":"1866.5","dur":"1.599","text":"Let&#39;s say, &quot;wget&quot;,"},"1870.00":{"start":"1870","dur":"1.39","text":"save it into the output file,"},"1873.37":{"start":"1873.37","dur":"1.67","text":"&quot;www.google.com&quot;,"},"1875.04":{"start":"1875.04","dur":"1.31","text":"save it."},"1876.35":{"start":"1876.35","dur":"6.56","text":"So now if I run Drake and say that I want\nto build &quot;download&quot;..."},"1882.91":{"start":"1882.91","dur":"3.21","text":"the reason is &quot;missing output&quot; because\n&quot;download&quot; file does not exist yet..."},"1887.64":{"start":"1887.64","dur":"2.91","text":"I confirm it..."},"1890.55":{"start":"1890.55","dur":"1.92","text":"and in the file &quot;download&quot;"},"1892.47":{"start":"1892.47","dur":"5.24","text":"we have the homepage of Google."},"1897.71":{"start":"1897.71","dur":"2.77","text":"Another useful feature of Drake that \nI&#39;d like to touch upon is methods."},"1902.46":{"start":"1902.46","dur":"5.16","text":"Methods is a simple way you can re-use \nsome of the code in your workflow."},"1907.62":{"start":"1907.62","dur":"4.139","text":"For example, what if &quot;output&quot; is not the\nonly file that we need to copy to HDFS?"},"1913.12":{"start":"1913.12","dur":"1.57","text":"What we can do instead\nis create a method"},"1916.59":{"start":"1916.59","dur":"3.28","text":"that runs exactly these commands"},"1919.87":{"start":"1919.87","dur":"2.889","text":"and name it &quot;copy-to-hdfs()&quot;."},"1925.78":{"start":"1925.78","dur":"4.53","text":"Now this creates a method with the same\nimplementation that we used before."},"1930.31":{"start":"1930.31","dur":"3.76","text":"And now to invoke this method"},"1934.07":{"start":"1934.07","dur":"2.19","text":"all we need to do"},"1936.26":{"start":"1936.26","dur":"2.88","text":"is define a step without a body"},"1941.60":{"start":"1941.6","dur":"1.51","text":"and give it the option with the method name."},"1944.82":{"start":"1944.82","dur":"3.34","text":"We haven&#39;t used options before \nbecause we didn&#39;t have to,"},"1948.16":{"start":"1948.16","dur":"2.21","text":"but any step definition after"},"1950.37":{"start":"1950.37","dur":"3.77","text":"output file and input file can have an\noptional section in"},"1954.98":{"start":"1954.98","dur":"3.179","text":"in square brackets that has one or several"},"1960.20":{"start":"1960.2","dur":"6.81","text":"name-value pairs. And in this case \nwe use the &quot;method&quot; option"},"1967.01":{"start":"1967.01","dur":"1.08","text":"and invoke it this way."},"1970.81":{"start":"1970.809","dur":"5.491","text":"Now let&#39;s copy something else to HDFS,"},"1976.30":{"start":"1976.3","dur":"7","text":"let&#39;s say, &quot;people&quot;."},"1985.14":{"start":"1985.14","dur":"7","text":"...sorry, &quot;people.sorted&quot;..."},"2000.00":{"start":"2000","dur":"2.71","text":"Now if I run Drake,"},"2002.71":{"start":"2002.71","dur":"2.76","text":"&quot;output&quot; doesn&#39;t have to be copied,\nbecause it&#39;s still up-to-date from"},"2005.47":{"start":"2005.47","dur":"2.039","text":"earlier experiments,"},"2007.51":{"start":"2007.509","dur":"3.431","text":"but this one does."},"2010.94":{"start":"2010.94","dur":"4.6","text":"And now if I made some changes \nto this code, I want to"},"2015.54":{"start":"2015.54","dur":"1.84","text":"be able to easily"},"2017.38":{"start":"2017.38","dur":"4.56","text":"re-run all the steps that use this\nmethod as an implementation."},"2021.94":{"start":"2021.94","dur":"1.31","text":"And this is possible:"},"2023.25":{"start":"2023.25","dur":"0.809","text":"you say: re-run all the targets"},"2026.95":{"start":"2026.95","dur":"3.539","text":"and them only, without an dependencies,\nthat use method &quot;copy-to-hdfs()&quot;."},"2033.55":{"start":"2033.55","dur":"6.86","text":"We need to use quotes now because\nparenthesis are special symbols for &quot;bash&quot;."},"2040.41":{"start":"2040.41","dur":"1.17","text":"And you see that"},"2041.58":{"start":"2041.58","dur":"1.559","text":"the steps are listed,"},"2043.14":{"start":"2043.139","dur":"1.401","text":"the reason is given,"},"2044.54":{"start":"2044.54","dur":"1.41","text":"this is &quot;forced (via method)&quot;,"},"2050.38":{"start":"2050.379","dur":"4.66","text":"and, of course, we can also \nsuppress confirmation"},"2055.04":{"start":"2055.039","dur":"6.75","text":"by using --auto command-line switch."},"2061.79":{"start":"2061.789","dur":"1.38","text":"And then finally,"},"2063.17":{"start":"2063.169","dur":"3.61","text":"I would like to touch on the notion of protocols."},"2066.78":{"start":"2066.779","dur":"1.41","text":"So far,"},"2069.39":{"start":"2069.389","dur":"3.29","text":"we didn&#39;t have to use anything other than shell,"},"2072.68":{"start":"2072.679","dur":"2.04","text":"but shell is not the only way\nto execute commands."},"2078.80":{"start":"2078.799","dur":"4.26","text":"Drake supports several protocols,\nand a protocol is basically"},"2083.06":{"start":"2083.059","dur":"5.82","text":"an interpreter - a way to execute \ncommands. In the shell case,"},"2088.88":{"start":"2088.879","dur":"3.49","text":"it creates a temporary file and \nruns the current shell on it,"},"2092.37":{"start":"2092.369","dur":"4.64","text":"in Python case or Ruby case,\nit might run the Python interpreter."},"2097.01":{"start":"2097.009","dur":"4.23","text":"There could be other protocols such as a\nPig query, then it would run a Pig query."},"2101.24":{"start":"2101.239","dur":"3.83","text":"So it all depends on the \nimplementation of the protocol"},"2106.33":{"start":"2106.329","dur":"4.44","text":"and currently the implemented protocols are\n&quot;shell&quot;, &quot;python&quot;, &quot;ruby&quot;"},"2111.65":{"start":"2111.65","dur":"2.459","text":"and some more complicated \nClojure-related ones."},"2114.11":{"start":"2114.109","dur":"3.52","text":"We also plan to implement a Cascalog protocol,"},"2117.63":{"start":"2117.629","dur":"1.21","text":"but generally\nyou can add pretty much anything."},"2121.65":{"start":"2121.65","dur":"1.31","text":"So let me show you some\nPython code, let&#39;s say."},"2126.32":{"start":"2126.319","dur":"2.67","text":"And we&#39;ll do some simple \nstatistics on the output,"},"2128.99":{"start":"2128.989","dur":"3.12","text":"just as we did with &quot;wc&quot;."},"2135.99":{"start":"2135.989","dur":"3.43","text":"Give it a tag name,"},"2139.42":{"start":"2139.419","dur":"2.67","text":"given it an input file,"},"2142.09":{"start":"2142.089","dur":"6.1","text":"&quot;Hello from Python!&quot;,"},"2148.19":{"start":"2148.189","dur":"1.42","text":"and let&#39;s print\nthe number of lines in the file."},"2163.01":{"start":"2163.009","dur":"3","text":"So, first of all we need to specify"},"2166.01":{"start":"2166.009","dur":"6.78","text":"that we want to use the &quot;python&quot; protocol.\nThere&#39;s a special option for that,"},"2172.79":{"start":"2172.789","dur":"1.87","text":"so we can do it this way,"},"2174.66":{"start":"2174.659","dur":"3.52","text":"but &quot;protocol&quot; is actually the default\noption name, so you don&#39;t even have"},"2178.18":{"start":"2178.179","dur":"3.56","text":"specify the option name here,\nso we can just leave it like this."},"2181.74":{"start":"2181.739","dur":"1.33","text":"It&#39;s a little bit more readable."},"2183.07":{"start":"2183.069","dur":"1.27","text":"Also notice that"},"2184.34":{"start":"2184.339","dur":"3.51","text":"the way that I refer to the variables\nis a little different."},"2187.85":{"start":"2187.849","dur":"5","text":"I can&#39;t just use the syntax we used for shell,\nbecause this is bash&#39;s syntax"},"2192.85":{"start":"2192.849","dur":"3.611","text":"to refer to environment variables."},"2196.46":{"start":"2196.46","dur":"3.239","text":"I can, of course, get to \nenvironment variables from Python"},"2199.70":{"start":"2199.699","dur":"1.281","text":"pretty easily,"},"2200.98":{"start":"2200.98","dur":"5.01","text":"but what this does is that this is a thing\nspecific to Drake and this is string substitution."},"2205.99":{"start":"2205.99","dur":"2.949","text":"Before giving these command lines to Python"},"2208.94":{"start":"2208.939","dur":"1.88","text":"Drake will substitute this string"},"2214.54":{"start":"2214.54","dur":"1.9","text":"with the actual name of the input file."},"2216.44":{"start":"2216.44","dur":"3.569","text":"This is why I have to quotes here,\nbecause Drake doesn&#39;t know what"},"2220.01":{"start":"2220.009","dur":"2.15","text":"the context of this is."},"2222.16":{"start":"2222.159","dur":"2.87","text":"And Drake will just substitute it \nfrom here to here."},"2225.03":{"start":"2225.029","dur":"3.81","text":"So let me save it."},"2228.84":{"start":"2228.839","dur":"5.84","text":"And specify it."},"2234.68":{"start":"2234.679","dur":"3.231","text":"&quot;Hello from Python!&quot;\n3"},"2237.91":{"start":"2237.91","dur":"1.099","text":"Great!"},"2239.01":{"start":"2239.009","dur":"3.12","text":"This is exactly how I wanted it to work."},"2242.13":{"start":"2242.129","dur":"3.91","text":"So we&#39;ve covered quite a lot of stuff:\nwe&#39;ve covered some basic features,"},"2246.04":{"start":"2246.039","dur":"4.05","text":"some advanced features, I gave you a\ndemonstration of how it works."},"2250.09":{"start":"2250.089","dur":"2.12","text":"Now let me go quickly over"},"2252.21":{"start":"2252.209","dur":"4.72","text":"some features that are still in\ndevelopment. They are specified"},"2256.93":{"start":"2256.929","dur":"3.22","text":"in the design doc that we released,"},"2260.15":{"start":"2260.149","dur":"4.08","text":"but they&#39;re still not ready yet.\nWe do invision Drake to have a nice"},"2264.23":{"start":"2264.229","dur":"4.65","text":"status console, so when you run a data\nworkflow, it would listen on some port,"},"2268.88":{"start":"2268.879","dur":"5","text":"show you the list of steps with links\nto their existing logs,"},"2273.88":{"start":"2273.879","dur":"2.43","text":"dependency graph of the current workflow,"},"2276.31":{"start":"2276.309","dur":"3.9","text":"color-coded with what&#39;s done and what&#39;s next..."},"2280.21":{"start":"2280.209","dur":"4.03","text":"Also, an important feature is management of\nhistoric versions of the data files,"},"2288.90":{"start":"2288.899","dur":"3.57","text":"because if you have a tool like that,\nthat is given the information about inputs"},"2292.47":{"start":"2292.469","dur":"1.761","text":"and outputs, then you could easily"},"2294.23":{"start":"2294.23","dur":"2.259","text":"implement some very powerful features"},"2296.49":{"start":"2296.489","dur":"3.84","text":"for example, you could specify that you want"},"2300.33":{"start":"2300.329","dur":"4.64","text":"it to to keep to the last six versions of the\noutput file, and then you can revert easily by"},"2304.97":{"start":"2304.969","dur":"2.01","text":"providing the moment in the past \nyou want to rever to."},"2306.98":{"start":"2306.979","dur":"4.411","text":"Or you can specify"},"2311.39":{"start":"2311.39","dur":"3.809","text":"that you want to keep all the\nold versions for the last three months,"},"2315.20":{"start":"2315.199","dur":"2.26","text":"or maybe even until the backups"},"2318.95":{"start":"2318.949","dur":"3.12","text":"exceed one hundred megabytes."},"2322.07":{"start":"2322.069","dur":"3.68","text":"So this could be a very convenient\nautomated backup and revert mechanism."},"2326.93":{"start":"2326.929","dur":"1.27","text":"We also want to"},"2328.20":{"start":"2328.199","dur":"4.77","text":"implement retries, email notifications,\nand other small things. One particular thing"},"2333.53":{"start":"2333.529","dur":"3.36","text":"that you can do once you specify \nyour workflow in this way is"},"2337.89":{"start":"2337.89","dur":"4.67","text":"parallelize processes because Drake knows\nthat in this particular example"},"2342.56":{"start":"2342.56","dur":"2.429","text":"Process 1 and Process 2 are independent,"},"2344.99":{"start":"2344.989","dur":"2.98","text":"so you can run them the same time."},"2347.97":{"start":"2347.969","dur":"4.28","text":"If these are remote processes or\nmap-reduces on a Hadoop cluster"},"2352.25":{"start":"2352.249","dur":"2.03","text":"or two different clusters,"},"2354.28":{"start":"2354.279","dur":"2.42","text":"this is what you would want to do anyway."},"2356.70":{"start":"2356.699","dur":"4.02","text":"And also maybe one of those processes is"},"2360.72":{"start":"2360.719","dur":"4.24","text":"I\/O heavy and another is CPU heavy,\nor you have a multicore machine"},"2366.86":{"start":"2366.859","dur":"5.12","text":"and single-threaded processes \nor something like that."},"2371.98":{"start":"2371.979","dur":"1.281","text":"But anyway, Drake can"},"2374.63":{"start":"2374.629","dur":"4.89","text":"know in what cases it be\nparallelized and launch them at the same time."},"2379.52":{"start":"2379.519","dur":"2.78","text":"So, of course, this is an open source project,\nwe do want to implement all these features,"},"2383.19":{"start":"2383.189","dur":"4.62","text":"but your contribution is also welcome. If you\nfind this tool to be useful, we would be"},"2387.81":{"start":"2387.809","dur":"1.91","text":"really happy to work with you,"},"2389.72":{"start":"2389.719","dur":"6.62","text":"and to review the code and to hear from you."},"2396.34":{"start":"2396.339","dur":"1.43","text":"So one last thing"},"2397.77":{"start":"2397.769","dur":"5.21","text":"that came up several times is\nwhy we implemented this as"},"2402.98":{"start":"2402.979","dur":"2.57","text":"a command-line tool vs. a library."},"2405.55":{"start":"2405.549","dur":"4.93","text":"A library obviously is very flexible,\nbecause you can run native code"},"2410.48":{"start":"2410.479","dur":"1.35","text":"instead of being limited\nby running binaries and shell commands."},"2416.35":{"start":"2416.349","dur":"2.14","text":"So, our approach to that is"},"2418.49":{"start":"2418.489","dur":"1.291","text":"everything that you see here,\nthis syntax"},"2423.98":{"start":"2423.979","dur":"3.93","text":"is just one of the possible frontends to Drake."},"2427.91":{"start":"2427.909","dur":"3.13","text":"Other frontends can be implemented, \nfor example,"},"2431.04":{"start":"2431.039","dur":"2.52","text":"one can re-use the core Drake library"},"2433.56":{"start":"2433.559","dur":"2.06","text":"and write a Clojure Domain Specific Language,"},"2435.62":{"start":"2435.619","dur":"2.85","text":"that could look\nsomething like this:"},"2438.47":{"start":"2438.469","dur":"3.61","text":"specify the steps in a similar\nway and give them"},"2442.08":{"start":"2442.079","dur":"4.41","text":"Clojure function which would be run,\ninstead of running"},"2446.49":{"start":"2446.489","dur":"2.87","text":"shell commands and child processes."},"2449.36":{"start":"2449.359","dur":"2.17","text":"And then you can run it like this,"},"2451.53":{"start":"2451.529","dur":"4.351","text":"having re-used the target selection\nmechanism that we talked about previously."},"2460.01":{"start":"2460.009","dur":"1.161","text":"So, we don&#39;t think that"},"2461.17":{"start":"2461.17","dur":"4.039","text":"it&#39;s either\/or, and we&#39;re looking forward to"},"2465.21":{"start":"2465.209","dur":"2.88","text":"people creating more libraries"},"2468.09":{"start":"2468.089","dur":"2.111","text":"in their favorite programming language."},"2472.17":{"start":"2472.169","dur":"4.4","text":"Everything that runs under JVM, \nI suppose, would be compatible"},"2478.35":{"start":"2478.349","dur":"2.7","text":"with Drake&#39;s core library."},"2481.05":{"start":"2481.049","dur":"3.601","text":"So, that&#39;s it. Thank you very much for\nlisting and we hope that"},"2484.65":{"start":"2484.65","dur":"4.02","text":"you will find it useful. Please do not\nhesitate to contact us with feedback,"},"2488.67":{"start":"2488.67","dur":"3.139","text":"bug reports, code contributions or questions."},"2491.81":{"start":"2491.809","dur":"1.5","text":"We&#39;re looking forward to"},"2493.31":{"start":"2493.309","dur":"3.98","text":"seeing this tool being used \nin other places than Factual,"},"2497.29":{"start":"2497.289","dur":"2.24","text":"and we hope that"},"2499.53":{"start":"2499.529","dur":"2.45","text":"you&#39;ll find of some value, as we did.\nThank you. Bye-bye."}}